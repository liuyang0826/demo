(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-4a9409f6"],{2293:function(e,t,a){"use strict";var s={getAccountInfo:"/admin/account/getAccountInfo",updateBaseUserInfo:"/admin/account/updateAccount",changeUserName:"/admin/account/updateAccountName",updatePassword:"/admin/account/updateAccountPassword",updatePhoto:"/admin/person/updatePhoto",toolBar:{getUserTools:"/admin/map/data/location/menu",getSystemTools:"/admin/map/system/toolbar/get"},mapStyle:"/admin/map/custom/style/get",chartsList:"/admin/map/custom/chart/list",findTypeTree:"/admin/typeDetail/findTypeTree",getMarkerData:"/admin/map/data/location/get",getTypeTree:"/admin/map/data/location/system/menu",getDetail:{device:"/admin/device/getOneById/",building:"/admin/building/getOneById/",car:"/admin/car/get/",person:"/admin/person/getPersonById?personId="},getAllEvent:"/admin/map/data/location/device/warn",getTenantInfo:"/admin/tenant/current/info"};t["a"]=s},2923:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-card",[a("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"el-icon-info"}),a("span",{staticClass:"header-title"},[e._v("基本信息")]),a("el-button",{staticClass:"save-btn",attrs:{type:"primary",size:"small"},on:{click:e.handleSave}},[e._v("保存")])],1),a("div",{staticClass:"card-body"},[a("el-form",{ref:"userInfo",attrs:{model:e.userInfo,rules:e.formRules,"label-width":"150px"}},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"用户名：",prop:"userName"}},[a("el-input",{attrs:{size:"small",disabled:e.isFirstChange},model:{value:e.userInfo.userName,callback:function(t){e.$set(e.userInfo,"userName",t)},expression:"userInfo.userName"}},[e.isFirstChange?a("el-button",{attrs:{slot:"append",size:"small",icon:"el-icon-edit"},on:{click:e.changeAccount},slot:"append"}):a("el-button",{attrs:{slot:"append",size:"small"},on:{click:e.goChangeAccout},slot:"append"},[e._v("确认")])],1)],1)],1),a("el-col",{attrs:{span:8,offset:1}},[a("el-form-item",{attrs:{label:"真实姓名：",prop:"realName"}},[a("el-input",{attrs:{size:"small"},model:{value:e.userInfo.realName,callback:function(t){e.$set(e.userInfo,"realName",t)},expression:"userInfo.realName"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"手机：",prop:"mobile"}},[a("el-input",{attrs:{size:"small"},model:{value:e.userInfo.mobile,callback:function(t){e.$set(e.userInfo,"mobile",t)},expression:"userInfo.mobile"}})],1)],1),a("el-col",{attrs:{span:8,offset:1}},[a("el-form-item",{attrs:{label:"性别：",prop:"gender"}},[a("el-radio-group",{attrs:{size:"small"},model:{value:e.userInfo.gender,callback:function(t){e.$set(e.userInfo,"gender",t)},expression:"userInfo.gender"}},[a("el-radio-button",{attrs:{label:"男"}}),a("el-radio-button",{attrs:{label:"女"}}),a("el-radio-button",{attrs:{label:"保密"}})],1)],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"生日：",prop:"birthDay"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd",size:"small"},model:{value:e.userInfo.birthDay,callback:function(t){e.$set(e.userInfo,"birthDay",t)},expression:"userInfo.birthDay"}})],1)],1)],1)],1)],1)]),e._l(e.teamList,(function(t,s){return a("el-card",{key:s},[a("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"el-icon-s-flag"}),a("span",{staticClass:"header-title"},[e._v("\n        团队信息"+e._s(s+1)+"  —  "),a("span",{staticStyle:{color:"#2678e7"}},[e._v(e._s(t.tenantName))])])]),a("el-row",{staticStyle:{"padding-top":"20px"},attrs:{gutter:40}},[a("el-col",{attrs:{span:8}},[a("el-row",{staticStyle:{height:"58px"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"team-name"},[e._v("所属团队：")])]),a("el-col",{attrs:{span:17,offset:1}},[a("el-input",{attrs:{size:"small",disabled:""},model:{value:t.tenantName,callback:function(a){e.$set(t,"tenantName",a)},expression:"team.tenantName"}})],1)],1),a("el-row",{staticStyle:{height:"58px"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"team-name"},[e._v("联系电话：")])]),a("el-col",{attrs:{span:17,offset:1}},[a("el-input",{attrs:{size:"small",disabled:""},model:{value:t.telPhone,callback:function(a){e.$set(t,"telPhone",a)},expression:"team.telPhone"}})],1)],1),a("el-row",{staticStyle:{height:"58px"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"team-name"},[e._v("邮箱：")])]),a("el-col",{attrs:{span:17,offset:1}},[a("el-input",{attrs:{size:"small",disabled:""},model:{value:t.email,callback:function(a){e.$set(t,"email",a)},expression:"team.email"}})],1)],1)],1),a("el-col",{attrs:{span:8,offset:1}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"team-name"},[e._v("头像：")])]),a("el-col",{attrs:{span:17,offset:1}},[a("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"team.loading"}],ref:"teamUpload",refInFor:!0,staticClass:"avatar-uploader",attrs:{data:t,"show-file-list":!1,action:"/api/file/upload","http-request":e.customHttpRequest,"on-change":function(t,a){return e.customChange(t,a,s)},"auto-upload":!1,accept:"image/jpeg,image/png,image/jpg"}},[t.photo?a("img",{staticClass:"avatar",attrs:{src:t.photo,alt:""}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1)],1),t.extInfoVO?[a("el-col",{attrs:{span:24}},[a("el-divider",[e._v("其他信息")])],1),a("el-col",{attrs:{span:24}},e._l(t.extInfoVO,(function(t,s){return a("el-col",{key:s,staticStyle:{"margin-bottom":"10px"},attrs:{span:8}},[a("el-row",{attrs:{gutter:0}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"team-name"},[e._v(e._s(t.name)+"：")])]),a("el-col",{attrs:{span:17,offset:1}},[t.value&&"object"==typeof t.value?a("div",{staticClass:"avatar-uploader"},[t.value.length?e._l(t.value,(function(e,t){return a("img",{key:t,staticClass:"avatar",attrs:{src:e.url,alt:""}})})):a("span",{staticClass:"gray"},[e._v("暂无")])],2):[t.value?a("el-input",{attrs:{size:"small",disabled:""},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}}):a("span",{staticClass:"gray"},[e._v("暂无")])]],2)],1)],1)})),1)]:e._e()],2)],1)}))],2)},n=[],r=(a("ac6a"),a("d225")),o=a("b0b4"),i=a("308d"),l=a("6bb5"),c=a("4e2b"),u=a("9ab4"),m=a("60a3"),d=a("75fb"),f=a("2293"),p=a("c195"),g=a("73ec"),h=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(i["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.userInfo={id:"",userName:"",realName:"",mobile:"",gender:"",birthDay:""},e.teamList=[],e.isFirstChange=!0,e.formRules={userName:{required:!0,message:"该选项为必填项",trigger:"change"},realName:{required:!0,message:"该选项为必填项",trigger:"change"},mobile:{required:!0,message:"该选项为必填项",trigger:"change"},gender:{required:!0,message:"该选项为必填项",trigger:"change"}},e.imgIndex=-1,e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"customHttpRequest",value:function(e){var t=this,a=e.data,s=this.createUploadForm(e.file);this.$http.post(e.action,s.formData,s.config).then((function(e){if(e.data.status){var s=e.data.data.accessUrl,n=t.$refs.teamUpload,r=n[t.imgIndex];r.clearFiles(),t.$http.post(f["a"].updatePhoto,{personId:a.personId,photo:s}).then((function(e){t.teamList[t.imgIndex].loading=!1,e.data.status?(t.$message.success("更新头像成功"),t.$set(t.teamList[t.imgIndex],"photo",s)):t.$message.error(e.data.message)})).catch((function(){t.teamList[t.imgIndex].loading=!1}))}else t.$message.error("图片上传失败"),t.teamList[t.imgIndex].loading=!1})).catch((function(){t.teamList[t.imgIndex].loading=!1}))}},{key:"createUploadForm",value:function(e){var t={config:{headers:{accessToken:"Bearer "+p["a"].get("accessToken"),"Content-Type":"multipart/form-data"}},formData:{}},a=new FormData;return a.append("file",e),t.formData=a,t}},{key:"customChange",value:function(e,t,a){this.imgIndex=a;var s=Object(d["b"])(e.raw),n=s.status,r=s.message,o=this.$refs.teamUpload,i=o[this.imgIndex];n?(this.teamList[this.imgIndex].loading=!0,i.submit()):(i.clearFiles(),this.$message.error(r))}},{key:"handleSave",value:function(){var e=this,t=this.$refs.userInfo;t.validate((function(t){if(!t)return!1;Object(d["d"])(e.userInfo.mobile)?e.saveForm():e.$message.warning("手机号格式错误")}))}},{key:"saveForm",value:function(){var e=this;this.$http.post(f["a"].updateBaseUserInfo,{realName:this.userInfo.realName,mobile:this.userInfo.mobile,gender:this.userInfo.gender,birthDay:this.userInfo.birthDay}).then((function(t){if(t.data.status){e.$message.success("保存成功");var a=localStorage.getItem("realName");a!==e.userInfo.realName&&(localStorage.setItem("realName",e.userInfo.realName),qTouch.emit("changeName",e.userInfo.realName))}else e.$message.error(t.data.message)}))}},{key:"changeAccount",value:function(){null==this.userInfo.userName||""===this.userInfo.userName?this.isFirstChange=!1:(this.isFirstChange=!0,this.$notify.warning("用户名只能更改一次"))}},{key:"goChangeAccout",value:function(){var e=this;""==this.userInfo.userName?this.$message.warning("用户名不能为空!"):this.$http.get(f["a"].changeUserName,{params:{userName:this.userInfo.userName}}).then((function(t){t.data.status?e.$message.success("用户名修改成功"):e.$message.error(t.data.message)}))}},{key:"getAccountInfo",value:function(){var e=this;this.$http.get(f["a"].getAccountInfo).then((function(t){if(t.data.status){g["a"].mapValue(e.userInfo,t.data.data);var a=t.data.data.accountTeamVOS;for(var s in localStorage.setItem("realName",t.data.data.realName),a)a[s].loading=!1,a[s].extInfoVO&&a[s].extInfoVO.length&&a[s].extInfoVO.forEach((function(e){/\[/.test(e.value)&&(e.value=JSON.parse(e.value))}));e.teamList=a}else e.$message.error(t.data.message)}))}},{key:"mounted",value:function(){this.getAccountInfo()}}]),t}(m["e"]);h=u["__decorate"]([Object(m["a"])({})],h);var v=h,b=v,I=(a("fa81"),a("2877")),y=Object(I["a"])(b,s,n,!1,null,"e6ac2dae",null);t["default"]=y.exports},"3b2b":function(e,t,a){var s=a("7726"),n=a("5dbc"),r=a("86cc").f,o=a("9093").f,i=a("aae3"),l=a("0bfb"),c=s.RegExp,u=c,m=c.prototype,d=/a/g,f=/a/g,p=new c(d)!==d;if(a("9e1e")&&(!p||a("79e5")((function(){return f[a("2b4c")("match")]=!1,c(d)!=d||c(f)==f||"/a/i"!=c(d,"i")})))){c=function(e,t){var a=this instanceof c,s=i(e),r=void 0===t;return!a&&s&&e.constructor===c&&r?e:n(p?new u(s&&!r?e.source:e,t):u((s=e instanceof c)?e.source:e,s&&r?l.call(e):t),a?this:m,c)};for(var g=function(e){e in c||r(c,e,{configurable:!0,get:function(){return u[e]},set:function(t){u[e]=t}})},h=o(u),v=0;h.length>v;)g(h[v++]);m.constructor=c,c.prototype=m,a("2aba")(s,"RegExp",c)}a("7a56")("RegExp")},"75fb":function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return i}));a("3b2b");var s=function(e){var t=new RegExp("^[1][3-9][0-9]{9}$");return t.test(e)},n=function(e){var t="image/jpeg"===e.type,a="image/jpg"===e.type,s="image/png"===e.type,n="image/bmp"===e.type,r=e.size/1024/1024<10;return t||a||s||n?r?{status:!0,message:""}:{status:!1,message:"上传图片大小不能超过 10MB!"}:{status:!1,message:"上传图片必须是/jpg/jpeg/png/bmp格式!"}};function r(e){var t={value:e,unit:"KB"};return e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="MB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="GB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="TB"))),t}function o(e){var t=e.value,a=e.unit;switch(a){case"KB":return Math.floor(t);case"MB":return Math.floor(1024*t);case"GB":return Math.floor(1024*t*1024);case"TB":return Math.floor(1024*t*1024*1024)}}var i=function(e,t){if(console.log(e),t){if(t.formatList&&t.formatList.every((function(t){return e.type!=="image/"+t})))return{status:!1,message:"上传图片必须是/".concat(t.formatList.join("/"),"格式!")};if(t.maxKbSize&&e.size/1024>t.maxKbSize){var a=r(t.maxKbSize);return{status:!1,message:"上传图片大小不能超过 ".concat(a.value).concat(a.unit,"!")}}}return{status:!0,message:""}}},f353:function(e,t,a){},fa81:function(e,t,a){"use strict";var s=a("f353"),n=a.n(s);n.a}}]);
//# sourceMappingURL=chunk-4a9409f6.32d02167.js.map