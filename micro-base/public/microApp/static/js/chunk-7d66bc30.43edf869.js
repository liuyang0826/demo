(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-7d66bc30"],{"096f":function(e,t,a){"use strict";var i={getPaging:"/admin/person/pagingPerson",add:"/admin/person/add",update:"/admin/person/update",delete:"/admin/person/delete",multipleDelete:"/admin/person/multipleDelete",findByMobile:"/admin/person/findByMobile",getPersonInfoById:"/admin/person/getPersonById",getPersonDevice:"/admin/personDevice/listDeviceByPersonId/personId/",cancelPersonDevice:"/admin/personDevice/unbind",bindPersonDevice:"/admin/personDevice/bind/personId/",updateGps:"/admin/personDevice/updateGPSMark/personDeviceId/",getTypeDetail:"/admin/typeDetail",findTypeTree:"/admin/typeDetail/findTypeTree",getTemplateByTypeDetaiId:"/admin/typeDetail/getTemplateByTypeDetaiId",deleteType:"/admin/typeDetail/delete",saveCustomAttrItems:"/admin/typeDetail/saveCustomAttrItems",getOrgTreeData:"/admin/organization/orgTree",getNewTypeTree:"/admin/organization/orgTree/person",roleList:"/admin/role/list",getDevicePaging:"/admin/device/pagingDevice",download:"/api/excel/download/personTemplate",upload:"/api/excel/upload/personTemplate"};t["a"]=i},1352:function(e,t,a){"use strict";var i=a("a69a"),s=a.n(i);s.a},"237f3":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("q-left-right-layout",{attrs:{"left-title":"人员类型","btn-tip":"添加一级节点","right-title":(e.basicForm.name||"")+"详情"},on:{click:function(t){return e.openTypeTreeNodeForm("addTop","")}}},[a("div",{attrs:{slot:"left"},slot:"left"},[a("el-input",{staticStyle:{"margin-bottom":"10px",padding:"0 10px"},attrs:{placeholder:"输入关键字进行过滤",maxlength:100,size:"small"},model:{value:e.treeMessage.filterText,callback:function(t){e.$set(e.treeMessage,"filterText",t)},expression:"treeMessage.filterText"}}),a("div",{staticClass:"tree-content"},[a("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:e.treeMessage.data,props:e.treeMessage.defaultProps,"node-key":"id","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{staticStyle:{display:"inline-block","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap","word-break":"keep-all"},style:{width:190-18*(i.level-1)+"px"},attrs:{title:i.label}},[e._v("\n              "+e._s(i.label)+"\n            ")]),a("span",[a("el-button",{staticClass:"el-icon-plus",attrs:{type:"text",size:"mini",title:"添加子节点"},on:{click:function(t){return e.openTypeTreeNodeForm("add",s)}}}),a("el-button",{staticClass:"el-icon-edit",attrs:{type:"text",size:"mini",title:"编辑节点"},on:{click:function(t){return e.openTypeTreeNodeForm("edit",s)}}}),a("el-button",{staticClass:"el-icon-delete",attrs:{type:"text",size:"mini",title:"删除节点"},on:{click:function(t){return e.remove(i,s)}}})],1)])}}])})],1)],1),a("div",{staticClass:"right",attrs:{slot:"right"},slot:"right"},[a("div",{staticClass:"basic-attribute"},[a("div",{staticClass:"content-title"},[a("i",{staticClass:"el-icon-menu"}),e._v("基础信息")]),a("div",{staticClass:"basic-attribute-body"},[a("el-form",{attrs:{"label-width":"100px",size:"small","status-icon":"",model:e.basicForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"名称：",prop:"name"}},[a("el-input",{attrs:{disabled:""},model:{value:e.basicForm.name,callback:function(t){e.$set(e.basicForm,"name",t)},expression:"basicForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"父节点名称："}},[a("el-input",{attrs:{disabled:""},model:{value:e.basicForm.parentName,callback:function(t){e.$set(e.basicForm,"parentName",t)},expression:"basicForm.parentName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"编号：",prop:"code"}},[a("el-input",{attrs:{disabled:""},model:{value:e.basicForm.code,callback:function(t){e.$set(e.basicForm,"code",t)},expression:"basicForm.code"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"图标：",prop:"icons"}},[a("q-upload",{attrs:{prev:"",disabled:"","limit-num":1,accept:"image/png,image/jpeg",size:2},model:{value:e.basicForm.icons,callback:function(t){e.$set(e.basicForm,"icons",t)},expression:"basicForm.icons"}})],1)],1)],1)],1)],1)]),e.hasCustomRole?a("div",{staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"content-title"},[a("el-icon",{staticClass:"el-icon-menu icon-blue"}),e._v("\n          自定义信息\n        ")],1),a("base-data-info-table",{ref:"baseDataInfoTable",attrs:{id:e.basicForm.id,active:"/admin/typeDetail/attr/pagingAttr/person/"}})],1):e._e()])]),a("add-person-prop",{attrs:{dialogTitle:e.dialogTitle,dialogVisible:e.visibleDialog,data:e.formData},on:{close:e.closeDialog,submit:e.saveTypeAndAttr}})],1)},s=[],o=a("d225"),n=a("b0b4"),l=a("308d"),r=a("6bb5"),d=a("4e2b"),c=a("9ab4"),m=a("60a3"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"addForm",attrs:{"label-width":"100px",size:"small",model:e.addForm,rules:e.formRules}},[a("div",{staticClass:"inline"},[a("el-form-item",{attrs:{label:"类型名称：",prop:"name"}},[a("el-input",{attrs:{size:"small",maxlength:100},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),a("el-form-item",{attrs:{label:"类型编码：",prop:"code"}},[a("el-input",{attrs:{size:"small",maxlength:100,placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位"},model:{value:e.addForm.code,callback:function(t){e.$set(e.addForm,"code",t)},expression:"addForm.code"}})],1),a("el-form-item",{attrs:{label:"图标：",prop:"icons"}},[a("q-upload",{attrs:{"limit-num":1,accept:"image/png,image/jpeg",size:2},model:{value:e.addForm.icons,callback:function(t){e.$set(e.addForm,"icons",t)},expression:"addForm.icons"}})],1)],1),e.hasCustomRole?a("div",{staticClass:"transfer"},[e.hasCustomRole?a("el-transfer",{staticStyle:{margin:"auto"},attrs:{filterable:"",titles:["未选择","已选择"],"button-texts":["解绑","绑定"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},data:e.transferData.data},model:{value:e.transferData.selected,callback:function(t){e.$set(e.transferData,"selected",t)},expression:"transferData.selected"}}):e._e()],1):e._e(),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closeDialog}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveSensorAttribute()}}},[e._v("确定")])],1)])],1)},u=[],f=(a("ac6a"),a("096f")),b=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(l["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.hasCustomRole=qTouch.getBaseTypeByCode("person"),e.addForm={id:"",name:"",code:"",icons:[]},e.addDialog=!1,e.loading=!1,e.formRules={name:{required:!0,trigger:"blur",message:"请输入名称"},code:{required:!0,trigger:"blur",message:"请输入编码"}},e.transferData={data:[],selected:[]},e}return Object(d["a"])(t,e),Object(n["a"])(t,[{key:"handleVisible",value:function(e){var t=this;this.addDialog=e,e&&this.$nextTick((function(){var e=t.$refs.addForm;e.resetFields(),t.addForm=JSON.parse(JSON.stringify(t.data)),t.data.icon&&(t.addForm.icons=[{name:"icon",url:t.data.icon}]),t.getTypeAndAttrs()}))}},{key:"closeDialog",value:function(){this.addDialog=!1,this.$emit("close")}},{key:"saveSensorAttribute",value:function(){var e=this,t=this.$refs.addForm;t.validate((function(t){if(!t)return!1;e.loading=!0;var a=f["a"].getTypeDetail+"/addTypeAndAttrs/person";e.addForm.id&&(a=f["a"].getTypeDetail+"/updateTypeAndAttrs/person");var i=e.addForm;e.addForm.icons&&e.addForm.icons.length?i.icon=e.addForm.icons[0].url?e.addForm.icons[0].url:"":i.icon="",i.attrs=e.transferData.selected,e.$http.post(a,i).then((function(t){e.loading=!1,t.data.status?(e.$message.success("操作成功"),e.addDialog=!1,e.$emit("submit",t.data.data)):e.$message(t.data.message)})).catch((function(){e.loading=!1}))}))}},{key:"getTypeAndAttrs",value:function(){var e=this,t=this;this.$http.get(f["a"].getTypeDetail+"/attr/transferData/person",{params:{typeDetailId:this.addForm.id}}).then((function(a){if(a.status)if(a.data.status){var i=a.data.data;t.transferData.data=[],i.data.forEach((function(e){t.transferData.data.push({key:e.id,label:e.attrName})})),t.transferData.selected=i.selected}else e.$message.error(a.data.message)}))}}]),t}(m["e"]);c["__decorate"]([Object(m["d"])({type:String,default:"添加人员类型"})],b.prototype,"dialogTitle",void 0),c["__decorate"]([Object(m["d"])({type:Boolean,default:!1})],b.prototype,"dialogVisible",void 0),c["__decorate"]([Object(m["d"])({type:Object,default:function(){return{}}})],b.prototype,"data",void 0),c["__decorate"]([Object(m["f"])("dialogVisible")],b.prototype,"handleVisible",null),b=c["__decorate"]([Object(m["a"])({components:{}})],b);var g=b,v=g,h=(a("1352"),a("2877")),y=Object(h["a"])(v,p,u,!1,null,"fb6ab38a",null),T=y.exports,D=a("0933"),F=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(l["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.treeMessage={filterText:"",data:[],defaultProps:{children:"children",label:"name"}},e.basicForm={},e.dialogTitle="",e.visibleDialog=!1,e.formData={id:"",name:"",code:""},e.hasCustomRole=qTouch.getBaseTypeByCode("person"),e}return Object(d["a"])(t,e),Object(n["a"])(t,[{key:"created",value:function(){this.getTypeTreeData()}},{key:"getTypeTreeData",value:function(){var e=this,t=this;this.$http.get(f["a"].getTypeDetail+"/findTypeTree/person").then((function(a){if(a.status)if(a.data.status){var i=a.data.data;t.treeMessage.data=i||[],e.basicForm.id||e.handleNodeClick(e.treeMessage.data[0])}else e.$message.error(a.data.message)}))}},{key:"handleNodeClick",value:function(e){this.basicForm=Object.assign({},e),this.basicForm.icon&&(this.basicForm.icons=[{name:"icon",url:this.basicForm.icon}])}},{key:"setFilterText",value:function(e){this.$refs.tree.filter(e)}},{key:"filterNode",value:function(e,t){return!e||-1!==t[this.treeMessage.defaultProps.label].indexOf(e)}},{key:"openTypeTreeNodeForm",value:function(e,t){switch(e){case"add":this.dialogTitle="添加人员类型",this.formData={id:"",name:"",code:""},this.formData.parentId=t.id,this.formData.level=t.level+1;break;case"edit":this.dialogTitle="编辑人员类型",this.formData=Object.assign({},t);break;case"addTop":this.dialogTitle="添加人员类型",this.formData={id:"",name:"",code:""},this.formData.level=1;break}this.visibleDialog=!0}},{key:"remove",value:function(e,t){var a=this;this.$confirm("删除该类型将会删除其所有子类型及下属数据，是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.$http.get(f["a"].deleteType+"/"+t.id).then((function(e){e.status&&(e.data.status?(a.$message.success("删除成功"),a.getTypeTreeData()):a.$message.error(e.data.message))}))})).catch((function(){}))}},{key:"saveTypeAndAttr",value:function(e){this.visibleDialog=!1,this.$refs["baseDataInfoTable"].getCustomAttributeList(),this.getTypeTreeData(),this.basicForm=Object.assign({},e)}},{key:"closeDialog",value:function(){this.visibleDialog=!1}}]),t}(m["e"]);c["__decorate"]([Object(m["f"])("treeMessage.filterText")],F.prototype,"setFilterText",null),F=c["__decorate"]([Object(m["a"])({filters:{formatterAttrType:D["a"]},components:{AddPersonProp:T}})],F);var k=F,x=k,C=(a("b9de"),Object(h["a"])(x,i,s,!1,null,"01bbf51c",null));t["default"]=C.exports},2966:function(e,t,a){},a69a:function(e,t,a){},b9de:function(e,t,a){"use strict";var i=a("2966"),s=a.n(i);s.a}}]);
//# sourceMappingURL=chunk-7d66bc30.43edf869.js.map