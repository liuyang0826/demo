(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-35edf032"],{"20a0":function(e,t,a){},3718:function(e,t,a){"use strict";var i=a("20a0"),s=a.n(i);s.a},"7d19":function(e,t,a){"use strict";var i={findTypeTree:"/admin/typeDetail/findTypeTree",getOrgTreeData:"/admin/organization/orgTree",getNewOrgTree:"/admin/organization/orgTree/building",getTemplateByTypeDetaiId:"/admin/typeDetail/getTemplateByTypeDetaiId",getBuildingList:"/admin/build/getBuildList",getPaging:"/admin/building/paging",add:"/admin/building/add",update:"/admin/building/update",delete:"/admin/building/delete",multipleDelete:"/admin/building/multipleDelete",getOneById:"/admin/building/getOneById",getFloorPaging:"/admin/building/floor/paging",addFloor:"/admin/building/floor/add",updateFloor:"/admin/building/floor/update",getAllFloorList:"/admin/building/floor/all",getBindDevice:"/admin/buildingFloorDevice/listDeviceByBuildingId/buildingId/",bindDevice:"/admin/buildingFloorDevice/bind/",cancleDevice:"/admin/buildingFloorDevice/unbind",getDevicePaging:"/admin/device/pagingDevice",switchPlace:"/admin/buildingFloorDevice/switchPlace/",deleteBuildingFlorr:"/admin/building/floor/delete/",getTypeDetail:"/admin/typeDetail",deleteType:"/admin/typeDetail/delete",saveCustomAttrItems:"/admin/typeDetail/saveCustomAttrItems"};t["a"]=i},b1dd:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("q-left-right-layout",{attrs:{"left-title":e.typeObject.name,"btn-tip":"添加一级节点","right-title":(e.basicForm.name||"")+"详情"},on:{click:function(t){return e.openTypeTreeNodeForm("addTop","")}}},[a("div",{attrs:{slot:"left"},slot:"left"},[a("el-input",{staticStyle:{"margin-bottom":"10px",padding:"0 10px"},attrs:{placeholder:"输入关键字进行过滤",maxlength:100,size:"small"},model:{value:e.treeMessage.filterText,callback:function(t){e.$set(e.treeMessage,"filterText",t)},expression:"treeMessage.filterText"}}),a("div",{staticClass:"tree-content"},[a("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:e.treeMessage.data,props:e.treeMessage.defaultProps,"node-key":"id","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{staticStyle:{display:"inline-block","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap","word-break":"keep-all"},style:{width:190-18*(i.level-1)+"px"},attrs:{title:i.label}},[e._v("\n              "+e._s(i.label)+"\n            ")]),a("span",[a("el-button",{staticClass:"el-icon-plus",attrs:{type:"text",size:"mini",title:"添加子节点"},on:{click:function(t){return e.openTypeTreeNodeForm("add",s)}}}),a("el-button",{staticClass:"el-icon-edit",attrs:{type:"text",size:"mini",title:"编辑节点"},on:{click:function(t){return e.openTypeTreeNodeForm("edit",s)}}}),a("el-button",{staticClass:"el-icon-delete",attrs:{type:"text",size:"mini",title:"删除节点"},on:{click:function(t){return e.remove(i,s)}}})],1)])}}])})],1)],1),a("div",{staticClass:"right",attrs:{slot:"right"},slot:"right"},[a("div",{staticClass:"basic-attribute"},[a("div",{staticClass:"content-title"},[a("i",{staticClass:"el-icon-menu"}),e._v("基础信息")]),a("div",{staticClass:"basic-attribute-body"},[a("el-form",{attrs:{"label-width":"100px",size:"small","status-icon":"",model:e.basicForm}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"名称：",prop:"name"}},[a("el-input",{attrs:{disabled:""},model:{value:e.basicForm.name,callback:function(t){e.$set(e.basicForm,"name",t)},expression:"basicForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"父节点名称："}},[a("el-input",{attrs:{disabled:""},model:{value:e.basicForm.parentName,callback:function(t){e.$set(e.basicForm,"parentName",t)},expression:"basicForm.parentName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"编号：",prop:"code"}},[a("el-input",{attrs:{disabled:""},model:{value:e.basicForm.code,callback:function(t){e.$set(e.basicForm,"code",t)},expression:"basicForm.code"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"图标：",prop:"icons"}},[a("q-upload",{attrs:{disabled:"","limit-num":1,accept:"image/png,image/jpeg",size:2},model:{value:e.basicForm.icons,callback:function(t){e.$set(e.basicForm,"icons",t)},expression:"basicForm.icons"}})],1)],1)],1)],1)],1)]),e.hasCustomRole?a("div",{staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"content-title"},[a("el-icon",{staticClass:"el-icon-menu icon-blue"}),e._v("\n          自定义信息\n        ")],1),a("base-data-info-table",{ref:"baseDataInfoTable",attrs:{id:e.basicForm.id,active:"/admin/typeDetail/attr/pagingAttr/building/"}})],1):e._e()])]),e.typeTreeNodeDialog?a("el-dialog",{attrs:{title:"添加"+e.typeObject.name,visible:e.typeTreeNodeDialog,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(t){e.typeTreeNodeDialog=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dialogBasicForm",attrs:{"label-width":"100px",size:"small",model:e.dialogBasicForm,rules:e.dialogBasicFormRules}},[a("el-form-item",{attrs:{label:"类型名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入类型名称",maxlength:100},model:{value:e.dialogBasicForm.name,callback:function(t){e.$set(e.dialogBasicForm,"name",t)},expression:"dialogBasicForm.name"}})],1),a("el-form-item",{attrs:{label:"类型编码：",prop:"code"}},[a("el-input",{attrs:{maxlength:100,placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位"},model:{value:e.dialogBasicForm.code,callback:function(t){e.$set(e.dialogBasicForm,"code",t)},expression:"dialogBasicForm.code"}})],1),a("el-form-item",{attrs:{label:"图标：",prop:"icons"}},[a("q-upload",{attrs:{prev:!1,"limit-num":1,accept:"image/png,image/jpeg",size:.05},model:{value:e.dialogBasicForm.icons,callback:function(t){e.$set(e.dialogBasicForm,"icons",t)},expression:"dialogBasicForm.icons"}})],1),e.hasCustomRole?a("div",{staticClass:"transfer"},[a("el-transfer",{staticStyle:{margin:"auto"},attrs:{filterable:"",titles:["未选择","已选择"],"button-texts":["解绑","绑定"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},data:e.transferData.data},model:{value:e.transferData.selected,callback:function(t){e.$set(e.transferData,"selected",t)},expression:"transferData.selected"}})],1):e._e(),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.typeTreeNodeDialog=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveTypeAndAttr()}}},[e._v("确定")])],1)],1)],1):e._e()],1)},s=[],l=(a("ac6a"),a("d225")),o=a("b0b4"),n=a("308d"),r=a("6bb5"),d=a("4e2b"),c=a("9ab4"),m=a("60a3"),u=a("7d19"),g=a("0933"),p=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(n["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.typeObject={name:"建筑类型",url:"/building"},e.method="add",e.treeMessage={filterText:"",data:[],defaultProps:{children:"children",label:"name"}},e.basicForm={icons:[]},e.dialogBasicForm={icons:[]},e.dialogBasicFormRules={name:{required:!0,message:"请输入设备名称",trigger:"change"},code:{required:!0,message:"请输入设备编码",trigger:"change"}},e.typeTreeNodeDialog=!1,e.transferData={data:[],selected:[]},e.loading=!1,e.hasCustomRole=qTouch.getBaseTypeByCode("building"),e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getTypeTreeData()}},{key:"getTypeTreeData",value:function(){var e=this,t=this;this.$http.get(u["a"].getTypeDetail+"/findTypeTree"+this.typeObject.url).then((function(a){if(a.status)if(a.data.status){var i=a.data.data;t.treeMessage.data=i||[],!e.basicForm.id&&i&&e.handleNodeClick(e.treeMessage.data[0])}else e.$message.error(a.data.message)}))}},{key:"handleNodeClick",value:function(e){this.basicForm=Object.assign({},e),e.icon&&(this.basicForm.icons=[{name:"icon",url:this.basicForm.icon}])}},{key:"setFilterText",value:function(e){this.$refs.tree.filter(e)}},{key:"filterNode",value:function(e,t){return!e||-1!==t[this.treeMessage.defaultProps.label].indexOf(e)}},{key:"openTypeTreeNodeForm",value:function(e,t){switch(e){case"add":this.method="add",this.dialogBasicForm={icons:[]},this.dialogBasicForm.parentId=t.id,this.dialogBasicForm.level=t.level+1;break;case"edit":this.method="edit",this.dialogBasicForm=Object.assign({},t),t.icon&&(this.dialogBasicForm.icons=[{name:"icon",url:t.icon}]);break;case"addTop":this.method="add",this.dialogBasicForm={},this.dialogBasicForm.level=1;break}this.typeTreeNodeDialog=!0,this.getTypeAndAttrs()}},{key:"remove",value:function(e,t){var a=this;this.$confirm("删除该类型将会删除其所有子类型及下属数据，是否删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.$http.get(u["a"].deleteType+"/"+t.id).then((function(e){e.status&&(e.data.status?(a.$message.success("删除成功"),a.getTypeTreeData()):a.$message.error(e.data.message))}))}))}},{key:"getTypeAndAttrs",value:function(){var e=this;this.$http.get(u["a"].getTypeDetail+"/attr/transferData"+this.typeObject.url,{params:{typeDetailId:this.dialogBasicForm.id}}).then((function(t){if(t.data.status){var a=t.data.data;e.transferData.data=[],a.data.forEach((function(t){e.transferData.data.push({key:t.id,label:t.attrName})})),e.transferData.selected=a.selected}else e.$message.error(t.data.message)}))}},{key:"saveTypeAndAttr",value:function(){var e=this;this.$refs.dialogBasicForm.validate((function(t){if(!t)return!1;e.loading=!0;var a=u["a"].getTypeDetail+"/addTypeAndAttrs"+e.typeObject.url;"edit"==e.method&&(a=u["a"].getTypeDetail+"/updateTypeAndAttrs"+e.typeObject.url);var i=e.dialogBasicForm;e.dialogBasicForm.icons&&e.dialogBasicForm.icons.length?i.icon=e.dialogBasicForm.icons[0].url?e.dialogBasicForm.icons[0].url:"":i.icon="",i.attrs=e.transferData.selected,e.$http.post(a,i).then((function(t){e.loading=!1,t.data.status?(e.$message.success("操作成功"),e.typeTreeNodeDialog=!1,e.getTypeTreeData(),e.basicForm=t.data.data,e.$refs["baseDataInfoTable"].getCustomAttributeList()):e.$message(t.data.message)})).catch((function(){e.loading=!1}))}))}}]),t}(m["e"]);c["__decorate"]([Object(m["f"])("treeMessage.filterText")],p.prototype,"setFilterText",null),p=c["__decorate"]([Object(m["a"])({filters:{formatterAttrType:g["a"]}})],p);var b=p,f=b,h=(a("3718"),a("2877")),y=Object(h["a"])(f,i,s,!1,null,"067ad34e",null);t["default"]=y.exports}}]);
//# sourceMappingURL=chunk-35edf032.4a290748.js.map