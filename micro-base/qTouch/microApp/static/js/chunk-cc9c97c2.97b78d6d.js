(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-cc9c97c2"],{"08fb":function(e,t,i){"use strict";var a=i("e8a8"),n=i.n(a);n.a},"0a49":function(e,t,i){var a=i("9b43"),n=i("626a"),s=i("4bf8"),r=i("9def"),o=i("cd1c");e.exports=function(e,t){var i=1==e,l=2==e,c=3==e,d=4==e,u=6==e,p=5==e||u,m=t||o;return function(t,o,v){for(var h,f,g=s(t),y=n(g),b=a(o,v,3),k=r(y.length),x=0,w=i?m(t,k):l?m(t,0):void 0;k>x;x++)if((p||x in y)&&(h=y[x],f=b(h,x,g),e))if(i)w[x]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return x;case 2:w.push(h)}else if(d)return!1;return u?-1:c||d?d:w}}},1060:function(e,t,i){},1973:function(e,t,i){},"3b2b":function(e,t,i){var a=i("7726"),n=i("5dbc"),s=i("86cc").f,r=i("9093").f,o=i("aae3"),l=i("0bfb"),c=a.RegExp,d=c,u=c.prototype,p=/a/g,m=/a/g,v=new c(p)!==p;if(i("9e1e")&&(!v||i("79e5")((function(){return m[i("2b4c")("match")]=!1,c(p)!=p||c(m)==m||"/a/i"!=c(p,"i")})))){c=function(e,t){var i=this instanceof c,a=o(e),s=void 0===t;return!i&&a&&e.constructor===c&&s?e:n(v?new d(a&&!s?e.source:e,t):d((a=e instanceof c)?e.source:e,a&&s?l.call(e):t),i?this:u,c)};for(var h=function(e){e in c||s(c,e,{configurable:!0,get:function(){return d[e]},set:function(t){d[e]=t}})},f=r(d),g=0;f.length>g;)h(f[g++]);u.constructor=c,c.prototype=u,i("2aba")(a,"RegExp",c)}i("7a56")("RegExp")},5090:function(e,t,i){},"6eca":function(e,t,i){},"717a":function(e,t,i){},7514:function(e,t,i){"use strict";var a=i("5ca1"),n=i("0a49")(5),s="find",r=!0;s in[]&&Array(1)[s]((function(){r=!1})),a(a.P+a.F*r,"Array",{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(s)},"75fb":function(e,t,i){"use strict";i.d(t,"d",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return o}));i("3b2b");var a=function(e){var t=new RegExp("^[1][3-9][0-9]{9}$");return t.test(e)},n=function(e){var t="image/jpeg"===e.type,i="image/jpg"===e.type,a="image/png"===e.type,n="image/bmp"===e.type,s=e.size/1024/1024<10;return t||i||a||n?s?{status:!0,message:""}:{status:!1,message:"上传图片大小不能超过 10MB!"}:{status:!1,message:"上传图片必须是/jpg/jpeg/png/bmp格式!"}};function s(e){var t={value:e,unit:"KB"};return e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="MB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="GB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="TB"))),t}function r(e){var t=e.value,i=e.unit;switch(i){case"KB":return Math.floor(t);case"MB":return Math.floor(1024*t);case"GB":return Math.floor(1024*t*1024);case"TB":return Math.floor(1024*t*1024*1024)}}var o=function(e,t){if(console.log(e),t){if(t.formatList&&t.formatList.every((function(t){return e.type!=="image/"+t})))return{status:!1,message:"上传图片必须是/".concat(t.formatList.join("/"),"格式!")};if(t.maxKbSize&&e.size/1024>t.maxKbSize){var i=s(t.maxKbSize);return{status:!1,message:"上传图片大小不能超过 ".concat(i.value).concat(i.unit,"!")}}}return{status:!0,message:""}}},8313:function(e,t,i){"use strict";var a=i("6eca"),n=i.n(a);n.a},8484:function(e,t,i){"use strict";var a=i("5090"),n=i.n(a);n.a},"85e5":function(e,t,i){"use strict";var a=i("1973"),n=i.n(a);n.a},9107:function(e,t,i){},"916a":function(e,t,i){"use strict";var a=i("717a"),n=i.n(a);n.a},a1b6:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:e.title,visible:e.visible,"close-on-click-modal":!1,width:"630px"},on:{"update:visible":function(t){e.visible=t},close:e.closeDialog}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"addForm",attrs:{model:e.addForm,rules:e.addRules,size:"small","label-width":"140px"}},[i("el-form-item",{attrs:{label:"传感器名称：",prop:"name"}},[i("el-input",{attrs:{maxlength:100,clearable:"",placeholder:"请输入传感器名称"},model:{value:e.addForm.name,callback:function(t){e.$set(e.addForm,"name",t)},expression:"addForm.name"}})],1),i("el-form-item",{attrs:{label:"传感器编码：",prop:"code"}},[i("el-input",{attrs:{maxlength:100,clearable:"",placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位"},model:{value:e.addForm.code,callback:function(t){e.$set(e.addForm,"code",t)},expression:"addForm.code"}})],1),i("el-form-item",{attrs:{label:"传感器类型：",prop:"sensorTypeId"}},[i("el-cascader",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入传感器类型","show-all-levels":!1,options:e.typeOptions,props:e.typeOptionsProps},model:{value:e.addForm.sensorTypeId,callback:function(t){e.$set(e.addForm,"sensorTypeId",t)},expression:"addForm.sensorTypeId"}})],1),i("el-form-item",{attrs:{label:"供应商传感器ID：",prop:"providerSensorId"}},[i("el-input",{attrs:{maxlength:100,clearable:"",placeholder:"请输入供应商传感器ID",disabled:!!e.addForm.id},model:{value:e.addForm.providerSensorId,callback:function(t){e.$set(e.addForm,"providerSensorId",t)},expression:"addForm.providerSensorId"}})],1),i("el-form-item",{attrs:{label:"供应商：",prop:"providerCode"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择供应商",disabled:!!e.addForm.id},model:{value:e.addForm.providerCode,callback:function(t){e.$set(e.addForm,"providerCode",t)},expression:"addForm.providerCode"}},e._l(e.providerOptions,(function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})})),1)],1),i("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",rows:3,maxlength:225},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.closeDialog}},[e._v("取消")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleAddSubmit}},[e._v("\n        确认\n      ")])],1)],1)],1)},n=[],s=i("d225"),r=i("b0b4"),o=i("308d"),l=i("6bb5"),c=i("4e2b"),d=i("9ab4"),u=i("60a3"),p=i("af19"),m=i("73ec"),v=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(o["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.providerOptions=[],e.visible=!1,e.loading=!1,e.addForm={},e.typeOptions=[],e.typeOptionsProps={value:"id",label:"name",showAllLevels:!1,checkStrictly:!0},e.addRules={name:{required:!0,trigger:"blur",message:"请输入传感器名称"},code:{required:!0,trigger:"blur",message:"请输入传感器编码"},sensorTypeId:{required:!0,trigger:"blur",message:"请选择传感器类型"},providerSensorId:{required:!0,trigger:"blur",message:"请输入供应商传感器ID"},providerCode:{required:!0,trigger:"change",message:"请输入供应商编码"}},e}return Object(c["a"])(t,e),Object(r["a"])(t,[{key:"created",value:function(){this.getSensorTypeData(),this.getSensorProviderList()}},{key:"visibleChange",value:function(e){var t=this;this.visible=e,e&&this.$nextTick((function(){var e=t.$refs.addForm;e.resetFields(),t.addForm=JSON.parse(JSON.stringify(t.data))}))}},{key:"closeDialog",value:function(){this.visible=!1,this.$emit("close")}},{key:"handleAddSubmit",value:function(){var e=this,t=this.$refs.addForm;t.validate((function(t){if(!t)return!1;e.loading=!0,"string"!==typeof e.addForm.sensorTypeId&&(e.addForm.sensorTypeId=m["a"].lastOfArr(e.addForm.sensorTypeId));var i=e.addForm.id?p["a"].updateSensor:e.deviceId?p["a"].addSensorAndBind+e.deviceId:p["a"].addSensor;e.$http.post(i,e.addForm).then((function(t){e.loading=!1,t.data.status?(e.$message.success(e.addForm.id?"编辑成功":"添加成功"),e.closeDialog(),e.$emit("submit")):e.$message.error(t.data.message)})).catch((function(){e.loading=!1}))}))}},{key:"getSensorTypeData",value:function(){var e=this;this.$http.get(p["a"].sensorTypeTree).then((function(t){t.data.status?(e.typeOptions=t.data.data,m["a"].removeEmptyChildren(e.typeOptions)):e.$message.error(t.data.message)}))}},{key:"getSensorProviderList",value:function(){var e=this;this.$http.post(p["a"].providerList,{}).then((function(t){t.data.status?e.providerOptions=t.data.data:e.$message.error(t.data.message)}))}}]),t}(u["e"]);d["__decorate"]([Object(u["d"])({type:String,default:"修改传感器信息"})],v.prototype,"title",void 0),d["__decorate"]([Object(u["d"])({type:Boolean,default:!1})],v.prototype,"sensorDialogVisible",void 0),d["__decorate"]([Object(u["d"])({type:Object})],v.prototype,"data",void 0),d["__decorate"]([Object(u["d"])({type:String})],v.prototype,"deviceId",void 0),d["__decorate"]([Object(u["f"])("sensorDialogVisible")],v.prototype,"visibleChange",null),v=d["__decorate"]([Object(u["a"])({})],v);var h=v,f=h,g=(i("c277"),i("2877")),y=Object(g["a"])(f,a,n,!1,null,"f6c034a6",null);t["a"]=y.exports},abac:function(e,t,i){"use strict";var a=i("bd11"),n=i.n(a);n.a},af19:function(e,t,i){"use strict";var a="/admin/sensor/",n={getAttributePaging:a+"attribute/paging",deleteAttribute:a+"attribute/delete/",addAttribute:a+"attribute/add",updateAttribute:a+"attribute/update",pageBysensorTypeId:a+"attribute/pageBySensorTypeId/",pageNotBindBysensorTypeId:a+"attribute/pageNotBindBySensorTypeId/",pageSensor:a+"paging",sensorTypeTree:a+"type/listTree",addSensorType:a+"type/add",updateSensorType:a+"type/update",deleteSensorType:a+"type/delete/",addSensorTypeAttribute:a+"type/attribute/add",deleteSensorTypeAttribute:a+"type/attribute/delete",pagingProvider:a+"provider/paging",addProvider:a+"provider/add",updateProvider:a+"provider/update",deleteProvider:a+"provider/delete/",providerList:a+"provider/list",getSensorList:a+"paging",addSensor:a+"add",updateSensor:a+"update",deleteSensorList:a+"delete",getSensorData:a+"sensorData",addSensorAndBind:a+"addAndBind/",sensorHistory:a+"sensorDataToChart",sensorCurrentData:a+"currentSensorDataToChart",getTimeQuantumData:a+"staticSensorDataToChart",download:"/api/excel/download/sensorTemplate",upload:"/api/excel/upload/sensorTemplate"};t["a"]=n},b9f5:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-button",{staticClass:"back",attrs:{size:"small"},on:{click:e.switchToDeviceList}},[e._v("返回")]),i("el-tabs",{staticClass:"content",attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{staticClass:"pane-content",attrs:{label:"基本信息",name:"1"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[i("el-form",{ref:"deviceDetailsForm",staticClass:"form",attrs:{model:e.deviceDetailsForm,rules:e.deviceDetailsFormRules,"label-width":"100px"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"设备名称：",prop:"name"}},[i("el-input",{attrs:{size:"small",maxlength:100},model:{value:e.deviceDetailsForm.name,callback:function(t){e.$set(e.deviceDetailsForm,"name",t)},expression:"deviceDetailsForm.name"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"设备类型：",prop:"typeDetailId"}},[i("q-tree",{attrs:{"tree-data":e.deviceTypeOptions,"tree-prop":{value:"id",label:"name"},title:"设备类型",multi:!1,"need-stringify":!0,closable:!1},on:{qClick:e.saveType},model:{value:e.deviceDetailsForm.typeDetailId,callback:function(t){e.$set(e.deviceDetailsForm,"typeDetailId",t)},expression:"deviceDetailsForm.typeDetailId"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"所属组织：",prop:"orgId"}},[i("q-tree",{attrs:{"tree-data":e.orgOptions,"tree-prop":{value:"id",label:"name"},title:"所属组织",multi:!1,"need-stringify":!0,closable:!1},on:{qClick:e.saveOrg},model:{value:e.deviceDetailsForm.orgId,callback:function(t){e.$set(e.deviceDetailsForm,"orgId",t)},expression:"deviceDetailsForm.orgId"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"设备编码：",prop:"code"}},[i("el-input",{attrs:{size:"small",maxlength:100,placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位"},model:{value:e.deviceDetailsForm.code,callback:function(t){e.$set(e.deviceDetailsForm,"code",t)},expression:"deviceDetailsForm.code"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"设备归类：",prop:"deviceClassifyIds"}},[i("q-tree",{attrs:{"tree-data":e.classifyOptions,"tree-prop":{value:"id",label:"name"},title:"设备归类",multi:!0,"need-stringify":!1,closable:!0},on:{qClick:e.saveClass},model:{value:e.deviceDetailsForm.deviceClassifyIds,callback:function(t){e.$set(e.deviceDetailsForm,"deviceClassifyIds",t)},expression:"deviceDetailsForm.deviceClassifyIds"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"启动状态：",prop:"status"}},[i("el-radio-group",{attrs:{size:"small"},model:{value:e.deviceDetailsForm.status,callback:function(t){e.$set(e.deviceDetailsForm,"status",t)},expression:"deviceDetailsForm.status"}},[i("el-radio-button",{attrs:{label:"true"}},[e._v("启用")]),i("el-radio-button",{attrs:{label:"false"}},[e._v("未启用")])],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"生产日期：",prop:"productionTime"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"small","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.deviceDetailsForm.productionTime,callback:function(t){e.$set(e.deviceDetailsForm,"productionTime",t)},expression:"deviceDetailsForm.productionTime"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"生产厂家：",prop:"installer"}},[i("el-input",{attrs:{size:"small",maxlength:100},model:{value:e.deviceDetailsForm.installer,callback:function(t){e.$set(e.deviceDetailsForm,"installer",t)},expression:"deviceDetailsForm.installer"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"安装日期：",prop:"installTime"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"small","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.deviceDetailsForm.installTime,callback:function(t){e.$set(e.deviceDetailsForm,"installTime",t)},expression:"deviceDetailsForm.installTime"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"备注信息：",prop:"remark"}},[i("el-input",{attrs:{size:"small",maxlength:255},model:{value:e.deviceDetailsForm.remark,callback:function(t){e.$set(e.deviceDetailsForm,"remark",t)},expression:"deviceDetailsForm.remark"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"设备位置："}},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.deviceDetailsForm.address,expression:"deviceDetailsForm.address"}],staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.deviceDetailsForm.address))]),i("el-button",{attrs:{type:"primary",size:"mini",disabled:e.disabled},on:{click:e.bindAddress}},[e._v(e._s(e.deviceDetailsForm.location?"查看":"绑定")+"\n                ")])],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"绑定状态：",prop:"status"}},[i("el-radio-group",{attrs:{size:"small",disabled:""},model:{value:e.deviceDetailsForm.bound,callback:function(t){e.$set(e.deviceDetailsForm,"bound",t)},expression:"deviceDetailsForm.bound"}},[i("el-radio-button",{attrs:{label:"true"}},[e._v("已绑定")]),i("el-radio-button",{attrs:{label:"false"}},[e._v("未绑定")])],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"上传图片："}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.deviceDetailsForm.image,expression:"deviceDetailsForm.image"}],staticClass:"upload-img"},[i("img",{attrs:{src:e.deviceDetailsForm.image,alt:""}}),i("div",{staticClass:"mask",on:{click:e.handleRemove}},[i("i",{staticClass:"el-icon-delete"})])]),i("el-upload",{directives:[{name:"show",rawName:"v-show",value:!e.deviceDetailsForm.image,expression:"!deviceDetailsForm.image"}],ref:"upload",attrs:{action:"/api/file/upload","list-type":"picture-card","http-request":e.customHttpRequest,"on-change":e.customChange,accept:"image/jpeg,image/png,image/jpg",disabled:e.disabled,"auto-upload":!1,multiple:!1,"show-file-list":!1,limit:1}},[i("i",{staticClass:"el-icon-plus"})])],1)],1)],1)],1),e.hasCustomRole?[i("div",[i("el-button",{attrs:{type:"text",disabled:""}},[e._v("\n              自定义属性\n            ")])],1),i("div",{staticClass:"card-body customRow"},[i("el-row",{attrs:{gutter:20}},[i("q-custom-input",{ref:"custom-input",attrs:{customOptions:e.customOptions}})],1)],1)]:e._e(),i("div",{staticClass:"block"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],attrs:{type:"primary",size:"small"},on:{click:e.saveDevice}},[e._v("保存 ")])],1)],2)]),e.deviceId?i("el-tab-pane",{staticClass:"pane-content",attrs:{label:"传感器",name:"2"}},[i("device-sensor",{attrs:{deviceId:e.deviceId},on:{update:function(t){return e.sensorList=t}}})],1):e._e(),e.deviceId?i("el-tab-pane",{staticClass:"panel-content",attrs:{label:"报警条件",name:"5"}},[i("status-alarm-condition",{attrs:{deviceId:e.deviceId,"all-status-list":e.allStatusList,"sensor-list":e.sensorList||[]}})],1):e._e(),e.deviceId?i("el-tab-pane",{staticClass:"panel-content",attrs:{label:"事件条件",name:"6"}},[i("event-alarm-condition",{attrs:{deviceId:e.deviceId,"all-status-list":e.allStatusList}})],1):e._e()],1),i("el-dialog",{attrs:{title:"设备位置选择","close-on-click-modal":!1,visible:e.addressDialog,width:"980px"},on:{"update:visible":function(t){e.addressDialog=t},close:function(t){return e.destroyMap()}}},[i("div",{staticStyle:{position:"relative"}},[i("div",{staticClass:"message"},[i("span",[e._v(e._s(e.text))]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showLeaveChoose,expression:"showLeaveChoose"}],staticStyle:{float:"right",margin:"4px 10px"}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.chooseOff}},[e._v("取消选取")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.showLeaveChoose,expression:"!showLeaveChoose"}],staticStyle:{float:"right",margin:"4px 10px"}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.chooseSiteOnMap}},[e._v("重新绑定")])],1)]),i("el-card",{staticClass:"card-content",attrs:{id:"deviceAmap"}}),i("div",{staticClass:"picker-box"},[i("input",{staticClass:"inp",attrs:{id:"deviceInput",placeholder:"输入关键字选取地点"}})])],1)])],1)},n=[],s=(i("6b54"),i("7f7f"),i("96cf"),i("3b8d")),r=i("d225"),o=i("b0b4"),l=i("308d"),c=i("6bb5"),d=i("4e2b"),u=i("9ab4"),p=i("60a3"),m=i("73ec"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"condition-wrap"},[i("q-title-bar",{attrs:{barTitle:"条件设置",btnName:"添加条件"},on:{click:e.handleAdd}}),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"condition"},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%","text-align":"center","min-height":"calc(100vh - 315px)"},attrs:{data:e.conditionList}},[i("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"100"}}),i("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"eventDefinitionName",label:"绑定事件","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleEdit(t.row)}}},[e._v("修改")]),i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleConfig(t.row)}}},[e._v("设置")]),i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除 ")])]}}])})],1)],1),i("el-dialog",{attrs:{title:e.conditionTitle,visible:e.conditionDialog,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.conditionDialog=t}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.conditionDialogLoading,expression:"conditionDialogLoading"}]},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules,size:"small","label-width":"80px"}},[i("el-form-item",{attrs:{label:"条件名称",prop:"name"}},[i("el-input",{attrs:{maxlength:100,placeholder:"请输入"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"条件编码",prop:"code"}},[i("el-input",{attrs:{maxlength:100,placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),i("el-form-item",{attrs:{label:"绑定事件",prop:"eventDefinitionId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"选择绑定事件"},model:{value:e.form.eventDefinitionId,callback:function(t){e.$set(e.form,"eventDefinitionId",t)},expression:"form.eventDefinitionId"}},e._l(e.eventData,(function(e){return i("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),i("el-form-item",{attrs:{label:"备注",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",maxlength:225},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.conditionDialog=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSureAdd}},[e._v("确定")])],1)],1)]),i("el-dialog",{attrs:{title:"条件设置",visible:e.configDialog,"close-on-click-modal":!1,width:"840px"},on:{"update:visible":function(t){e.configDialog=t}}},[i("div",{staticClass:"config-name"},[e._v("\n      条件名称："+e._s(e.form.name)+"\n      "),i("el-button",{staticStyle:{float:"right"},attrs:{size:"small",type:"primary"},on:{click:e.handleAddOne}},[e._v("添加")])],1),e._l(e.configList,(function(t,a){return i("div",{key:a,staticClass:"config-col"},[i("div",{staticClass:"num"},[e._v(e._s(a+1))]),i("el-select",{staticClass:"input",staticStyle:{"margin-left":"0"},attrs:{size:"small"},on:{change:function(i){e.$set(t,"sensorAttributeId",""),e.getSensorAttr(t,a)}},model:{value:t.sensorId,callback:function(i){e.$set(t,"sensorId",i)},expression:"item.sensorId"}},e._l(e.sensorList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1),i("el-select",{staticClass:"input",attrs:{size:"small"},model:{value:t.sensorAttributeId,callback:function(i){e.$set(t,"sensorAttributeId",i)},expression:"item.sensorAttributeId"}},e._l(t.attrList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1),i("el-select",{staticStyle:{width:"100px","margin-left":"10px"},attrs:{size:"small"},model:{value:t.compareType,callback:function(i){e.$set(t,"compareType",i)},expression:"item.compareType"}},e._l(e.compareTypeList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),i("el-input",{staticClass:"input",attrs:{size:"small",maxlength:100},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}}),i("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.handleDeleteOne(a)}}})],1)})),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.configDialog=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSureConfig}},[e._v("确定")])],1)],2)],1)},h=[],f=(i("8e6e"),i("456d"),i("ac6a"),i("bd86")),g=i("ef0f");function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function b(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach((function(t){Object(f["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var k=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.conditionList=[],e.tableLoading=!1,e.conditionDialog=!1,e.conditionTitle="",e.conditionDialogLoading=!1,e.eventLoading=!1,e.form={},e.formRules={name:{required:!0,message:"该选项为必填项",trigger:"change"},code:{required:!0,message:"该选项为必填项",trigger:"change"},eventDefinitionId:{required:!0,message:"该选项为必填项",trigger:"change"}},e.eventData=[],e.eventName="",e.pagination={current:1,size:99999},e.eventTotal=0,e.configDialog=!1,e.configList=[],e.sensorList=[],e.compareTypeList=[{label:"小于等于",value:"LE"},{label:"小于",value:"LT"},{label:"大于等于",value:"GE"},{label:"大于",value:"GT"},{label:"等于",value:"EQ"},{label:"不等于",value:"NE"}],e.typeOptions=[],e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getConditionList()}},{key:"handleAdd",value:function(){var e=this;this.conditionTitle="添加条件",this.form={},this.conditionDialog=!0,this.getEventData(),this.$nextTick((function(){var t=e.$refs.form;t.clearValidate()}))}},{key:"getEventData",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.eventLoading=!0,e.prev=1,e.next=4,this.$http.post(g["a"].getEventDefinition,b({},this.pagination,{query:{name:""}}));case 4:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?(this.eventData=a.records,this.eventTotal=a.total):this.$message.error(s);case 10:return e.prev=10,this.eventLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSureAdd",value:function(){var e=this,t=this.$refs.form;t.validate((function(t){t&&e.saveCondition()}))}},{key:"handleEdit",value:function(e){this.conditionTitle="修改条件",this.form=JSON.parse(JSON.stringify(e)),this.conditionDialog=!0,this.getEventData()}},{key:"saveCondition",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.conditionDialogLoading=!0,e.prev=1,e.next=4,this.$http.post(this.form.id?g["a"].updateCondition:g["a"].addCondition,b({},this.form,{deviceId:this.deviceId}));case 4:t=e.sent,i=t.data,i.data,a=i.status,n=i.message,a?(this.getConditionList(),this.conditionDialog=!1,this.$message.success(this.form.id?"修改成功":"添加成功")):this.$message.error(n);case 10:return e.prev=10,this.conditionDialogLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleDelete",value:function(e){var t=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteCondition(e)}))}},{key:"deleteCondition",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].deleteCondition+t.id);case 2:i=e.sent,a=i.data,a.data,n=a.status,s=a.message,n?(this.getConditionList(),this.$message.success("删除成功")):this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getConditionList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.tableLoading=!0,e.prev=1,e.next=4,this.$http.get(g["a"].getConditionList+this.deviceId);case 4:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.conditionList=a:this.$message.error(s);case 10:return e.prev=10,this.tableLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleConfig",value:function(e){var t=this;this.getSensorList(),this.form=e,this.configList=JSON.parse(JSON.stringify(e.items)),this.configList.forEach((function(e,i){t.getSensorAttr(e,i)})),this.configList.length||(this.configList=[{}]),this.configDialog=!0}},{key:"getSensorList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getBindSensor+this.deviceId);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.sensorList=a||[]:this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSensorAttr",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,i){var a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getSensorAttr+this.configList[i].sensorId);case 2:a=e.sent,n=a.data,s=n.data,r=n.status,o=n.message,r?(this.configList[i].attrList=s,this.$forceUpdate()):this.$message.error(o);case 8:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"handleAddOne",value:function(){this.configList.push({attrList:[]})}},{key:"handleDeleteOne",value:function(e){this.configList.splice(e,1)}},{key:"handleSureConfig",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.configList.map((function(e){return{sensorId:e.sensorId,sensorAttributeId:e.sensorAttributeId,compareType:e.compareType,value:e.value}})),e.next=3,this.$http.post(g["a"].updateConditionItem+this.form.id,t);case 3:i=e.sent,a=i.data,a.data,n=a.status,s=a.message,n?(this.configDialog=!1,this.$message.success("设置成功"),this.getConditionList()):this.$message.error(s);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String})],k.prototype,"deviceId",void 0),k=u["__decorate"]([Object(p["a"])({})],k);var x=k,w=x,S=(i("fe29"),i("2877")),D=Object(S["a"])(w,v,h,!1,null,"b745bc2c",null),I=D.exports,O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"style-wrap"},[i("q-title-bar",{attrs:{barTitle:"设备状态",btnName:"添加设备状态"},on:{click:e.handleAddStatus}}),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{"margin-top":"20px"}},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%","text-align":"center","min-height":"calc(100vh - 315px)"},attrs:{data:e.tableData}},[i("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"100"}}),i("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.row.deviceConditions}},[i("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"100"}}),i("el-table-column",{attrs:{prop:"name",label:"名称"}}),i("el-table-column",{attrs:{prop:"code",label:"编码"}}),i("el-table-column",{attrs:{prop:"remark",label:"备注"}})],1)]}}])}),i("el-table-column",{attrs:{prop:"name",label:"名称"}}),i("el-table-column",{attrs:{prop:"code",label:"编码"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-paperclip"},on:{click:function(i){return e.handleBindCondition(t.row)}}},[e._v("条件绑定")]),i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-menu"},on:{click:function(i){return e.handleEditStyle(t.row)}}},[e._v("样式")]),i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleEditStatus(t.row)}}},[e._v("修改")]),i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDeleteStatus(t.row)}}},[e._v("删除 ")])]}}])})],1)],1),i("el-dialog",{attrs:{title:e.statusDialogTitle,visible:e.statusDialog,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.statusDialog=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"form",attrs:{model:e.form,rules:e.formRules,size:"small","label-width":"100px"}},[i("el-form-item",{attrs:{label:"状态名称：",prop:"name"}},[i("el-input",{attrs:{maxlength:100,placeholder:"请输入状态名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"状态编码：",prop:"code"}},[i("el-input",{attrs:{maxlength:100,placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.statusDialog=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSureStatus}},[e._v("确定")])],1)],1)],1),i("el-dialog",{attrs:{title:"条件绑定",visible:e.conditionDialog,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.conditionDialog=t}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.conditionLoading,expression:"conditionLoading"}]},[i("el-table",{ref:"conditionTable",attrs:{data:e.conditionList},on:{"selection-change":e.handleSelectTable}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),i("el-table-column",{attrs:{type:"index",label:"序号",width:"100"}}),i("el-table-column",{attrs:{label:"条件名称",prop:"name","header-align":"center",align:"center","show-overflow-tooltip":""}})],1),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.conditionDialog=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addDeviceStatusConditions}},[e._v("确定")])],1)],1)]),i("el-dialog",{attrs:{title:"设备样式管理",visible:e.styleDialog,"close-on-click-modal":!1,width:"800px"},on:{"update:visible":function(t){e.styleDialog=t}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.styleLoading,expression:"styleLoading"}]},[i("div",{staticClass:"style-dialog"},[i("div",{staticClass:"map"}),i("div",{staticClass:"form"},[i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[e._v("颜色")]),i("div",{staticClass:"bg"},[i("div",{staticClass:"value"},[e._v(e._s(e.styleForm.styleColor))]),i("el-color-picker",{attrs:{size:"mini"},model:{value:e.styleForm.styleColor,callback:function(t){e.$set(e.styleForm,"styleColor",t)},expression:"styleForm.styleColor"}})],1)]),i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[e._v("大小")]),i("el-input-number",{staticStyle:{width:"230px"},attrs:{size:"small","controls-position":"right",min:1,max:30},model:{value:e.styleForm.styleSize,callback:function(t){e.$set(e.styleForm,"styleSize",t)},expression:"styleForm.styleSize"}})],1),i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[e._v("提示方式")]),i("div",[i("el-radio",{attrs:{label:"none"},model:{value:e.styleForm.styleTips,callback:function(t){e.$set(e.styleForm,"styleTips",t)},expression:"styleForm.styleTips"}},[e._v("无")]),i("el-radio",{attrs:{label:"bubble"},model:{value:e.styleForm.styleTips,callback:function(t){e.$set(e.styleForm,"styleTips",t)},expression:"styleForm.styleTips"}},[e._v("冒泡")]),i("el-radio",{attrs:{label:"twinkle"},model:{value:e.styleForm.styleTips,callback:function(t){e.$set(e.styleForm,"styleTips",t)},expression:"styleForm.styleTips"}},[e._v("高亮闪烁")])],1)])])]),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.styleDialog=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSureStyle}},[e._v("确定")])],1)])])],1)},C=[];function _(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function L(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?_(Object(i),!0).forEach((function(t){Object(f["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var $=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.tableData=[],e.tableLoading=!1,e.statusDialog=!1,e.statusDialogTitle="",e.form={},e.formLoading=!1,e.formRules={name:{required:!0,message:"该选项为必填项",trigger:"change"},code:{required:!0,message:"该选项为必填项",trigger:"change"}},e.conditionDialog=!1,e.conditionLoading=!1,e.conditionList=[],e.conditionIds=[],e.styleDialog=!1,e.styleLoading=!1,e.styleForm={},e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getTableData()}},{key:"getTableData",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.tableLoading=!0,e.prev=1,e.next=4,this.$http.get(g["a"].getDeviceStatusList+this.deviceId);case 4:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.tableData=a:this.$message.error(s);case 10:return e.prev=10,this.tableLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleAddStatus",value:function(){var e=this;this.statusDialogTitle="添加设备状态",this.statusDialog=!0,this.form={},this.$nextTick((function(){var t=e.$refs.form;t.clearValidate()}))}},{key:"handleEditStatus",value:function(e){var t=this;this.statusDialogTitle="修改设备状态",this.statusDialog=!0,this.form=JSON.parse(JSON.stringify(e)),this.$nextTick((function(){var e=t.$refs.form;e.clearValidate()}))}},{key:"handleDeleteStatus",value:function(e){var t=this;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteStatus(e)}))}},{key:"handleSureStatus",value:function(){var e=this,t=this.$refs.form;t.validate((function(t){t&&(e.formLoading=!0,e.saveStatus())}))}},{key:"saveStatus",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$http.post(g["a"][this.form.id?"updateDeviceStatus":"addDeviceStatus"],L({},this.form,{deviceId:this.deviceId}));case 3:t=e.sent,i=t.data,i.data,a=i.status,n=i.message,this.formLoading=!1,a?(this.$message.success(this.form.id?"修改成功":"添加成功"),this.getTableData(),this.statusDialog=!1):this.$message.error(n);case 10:return e.prev=10,this.formLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,,10,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"deleteStatus",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].deleteDeviceStatus+t.id);case 2:i=e.sent,a=i.data,n=a.data,s=a.status,r=a.message,s?(this.conditionList=n,this.$message.success("删除成功"),this.getTableData()):this.$message.error(r);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getConditionList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getConditionList+this.deviceId);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?(this.conditionList=a,this.$nextTick((function(){r.conditionList.forEach((function(e){r.$refs.conditionTable.toggleRowSelection(e,r.form.deviceConditions.some((function(t){return t.id===e.id})))}))}))):this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleBindCondition",value:function(e){this.getConditionList(),this.conditionDialog=!0,this.form=e}},{key:"handleSelectTable",value:function(e){this.conditionIds=e.map((function(e){return e.id}))}},{key:"addDeviceStatusConditions",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.conditionLoading=!0,e.prev=1,e.next=4,this.$http.post(g["a"].addDeviceStatusConditions+this.form.id,this.conditionIds);case 4:t=e.sent,i=t.data,i.data,a=i.status,n=i.message,a?(this.$message.success("绑定成功"),this.conditionDialog=!1,this.getTableData()):this.$message.error(n);case 10:return e.prev=10,this.conditionLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleEditStyle",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.styleDialog=!0,this.form=t,this.styleForm={styleColor:t.styleColor,styleSize:t.styleSize,styleTips:t.styleTips};case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleSureStyle",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.styleLoading=!0,e.prev=1,e.next=4,this.$http.post(g["a"].updateDeviceStatusStyle+this.form.id,this.styleForm);case 4:t=e.sent,i=t.data,i.data,a=i.status,n=i.message,a?(this.$message.success("修改成功"),this.styleDialog=!1,this.getTableData()):this.$message.error(n);case 10:return e.prev=10,this.styleLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})));function t(){return e.apply(this,arguments)}return t}()}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String})],$.prototype,"deviceId",void 0),$=u["__decorate"]([Object(p["a"])({})],$);var j=$,T=j,F=(i("abac"),Object(S["a"])(T,O,C,!1,null,"df0fc40e",null)),R=F.exports,z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"title-bar"},[e._m(0),i("el-button",{attrs:{icon:"el-icon-plus",size:"small",type:"primary"},on:{click:e.handleAddSensor}},[e._v("添加传感器")]),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-paperclip",size:"small",type:"primary"},on:{click:e.bindSensor}},[e._v("绑定传感器")])],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[i("el-table",{staticStyle:{width:"100%","margin-top":"20px","min-height":"calc(100vh - 315px)"},attrs:{data:e.sensorList}},[i("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"100"}}),i("el-table-column",{attrs:{prop:"name",label:"传感器名称","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"code",label:"传感器编号","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"sensorTypeName",label:"传感器类型","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"providerCode",label:"供应商","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:function(i){return e.handleEdit(t.row)}}},[e._v("编辑")]),i("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.cancelBind(t.row.id)}}},[e._v("取消绑定")])]}}])})],1)],1),i("el-dialog",{attrs:{title:"未绑定的传感器列表",visible:e.noBindSensorDialogVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.noBindSensorDialogVisible=t}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[i("div",[i("el-input",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{size:"small",maxlength:100,placeholder:"输入需要查询的传感器名称"},on:{blur:e.getNoBindSensorList},model:{value:e.pageParam2.query.name,callback:function(t){e.$set(e.pageParam2.query,"name",t)},expression:"pageParam2.query.name"}}),i("q-search-button",{on:{click:e.getNoBindSensorList}})],1),i("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.noBindSensorList},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),i("el-table-column",{attrs:{align:"center",prop:"name",label:"传感器名称","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{align:"center",prop:"code",label:"传感器编号","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{align:"center",prop:"sensorTypeName",label:"传感器类型","show-overflow-tooltip":""}})],1),i("q-pagination",{attrs:{"current-page":e.pageParam2.current,"page-sizes":[10,20,30,40],"page-size":e.pageParam2.size,layout:"total, sizes, prev, pager, next, jumper",total:e.pageParam2.total},on:{"size-change":e.handleSizeChange2,"current-change":e.handleCurrentChange2}}),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.noBindSensorDialogVisible=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveBind}},[e._v("确认")])],1)],1)]),i("sensor-detail",{attrs:{title:e.sensorDialogTitle,sensorDialogVisible:e.sensorDialogVisible,data:e.dataForm,"device-id":e.deviceId},on:{close:e.closeDialog,submit:e.getSensorList}})],1)},E=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("i",{staticClass:"icon-style el-icon-info"}),e._v("传感器绑定")])}],P=i("a1b6"),A=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.sensorList=[],e.noBindSensorList=[],e.noBindSensorDialogVisible=!1,e.loading=!1,e.dialogLoading=!1,e.multipleSelection=[],e.pageParam2={current:1,size:10,query:{name:"",bound:"false"}},e.sensorDialogVisible=!1,e.dataForm={},e.sensorDialogTitle="",e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"handleSelectionChange",value:function(e){this.multipleSelection=e}},{key:"mounted",value:function(){this.getSensorList()}},{key:"handleAddSensor",value:function(){this.dataForm={},this.sensorDialogVisible=!0,this.sensorDialogTitle="添加传感器"}},{key:"handleEdit",value:function(e){this.sensorDialogTitle="修改传感器信息",this.dataForm=JSON.parse(JSON.stringify(e)),this.sensorDialogVisible=!0}},{key:"closeDialog",value:function(){this.sensorDialogVisible=!1}},{key:"getSensorList",value:function(){var e=this;this.loading=!0,this.$http.get(g["a"].getBindSensor+this.deviceId).then((function(t){t.data.status?(e.sensorList=t.data.data,e.$emit("update",e.sensorList)):e.$message.error(t.data.message)})).finally((function(){e.loading=!1}))}},{key:"getNoBindSensorList",value:function(){var e=this;this.dialogLoading=!0,this.$http.post(g["a"].getSensorPage,this.pageParam2).then((function(t){t.data.status?(e.noBindSensorList=t.data.data.records,e.pageParam2.total=t.data.data.total):e.$message.error(t.data.message)})).finally((function(){e.dialogLoading=!1}))}},{key:"handleSizeChange2",value:function(e){this.pageParam2.size=e,this.getNoBindSensorList()}},{key:"handleCurrentChange2",value:function(e){this.pageParam2.current=e,this.getNoBindSensorList()}},{key:"saveBind",value:function(){var e=this;if(0!=this.multipleSelection.length){this.dialogLoading=!0;var t=g["a"].deviceBindSensor.concat(this.deviceId);this.$http.post(t,this.multipleSelection.map((function(e){return e.id}))).then((function(t){t.data.status?(e.$message.success("绑定成功!"),e.getSensorList(),e.noBindSensorDialogVisible=!1):e.$message.error(t.data.message)})).finally((function(){e.dialogLoading=!1}))}else this.$message.warning("未选择需要绑定的传感器!")}},{key:"bindSensor",value:function(){this.noBindSensorDialogVisible=!0,this.pageParam2={current:1,size:10,query:{name:"",bound:"false"}},this.getNoBindSensorList()}},{key:"cancelBind",value:function(e){var t=this;this.loading=!0,this.$http.post(g["a"].deleteBindSensor,{deviceId:this.deviceId,sensorId:e}).then((function(e){e.data.status?(t.$message.success("操作成功"),t.getSensorList()):t.$message.error(e.data.message)})).finally((function(){t.loading=!1}))}}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String})],A.prototype,"deviceId",void 0),A=u["__decorate"]([Object(p["a"])({components:{SensorDetail:P["a"]}})],A);var B,N=A,M=N,q=(i("8313"),Object(S["a"])(M,z,E,!1,null,"49e1a47c",null)),V=q.exports,J=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"header"},[i("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleAddCondition}},[e._v("添加报警条件")])],1),e._l(e.conditions,(function(t,a){return i("status-condition-config",{key:t.id||t.key,staticStyle:{"margin-top":"20px"},attrs:{index:a,data:t,"sensor-id-attr-map":e.sensorIdAttrMap,"sensor-list":e.sensorList,"all-status-list":e.allStatusList,"disable-status-id-map":e.disableStatusIdMap,"role-list":e.roleList,"device-id":e.deviceId},on:{getSensorAttr:e.getSensorAttr,delete:function(t){return e.conditions.splice(a,1)},update:e.getConditionList}})}))],2)},K=[],W=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"condition-container"},[i("div",{staticClass:"bar"},[i("div",{staticClass:"title"},[e._v("条件"+e._s(e.index+1))])]),i("el-form",{ref:"form",staticStyle:{"margin-top":"20px"},attrs:{model:e.data,rules:e.formRules,size:"small","label-width":"80px"}},[i("el-form-item",{attrs:{label:"说明",prop:"remark"}},[i("el-input",{model:{value:e.data.remark,callback:function(t){e.$set(e.data,"remark",t)},expression:"data.remark"}})],1),i("el-form-item",{attrs:{label:"当",prop:"condition"}},[i("div",{on:{click:function(t){return t.stopPropagation(),e.handleFocusRuleInput(e.cursorIndex)}}},[i("div",{staticClass:"condition-section",class:{focus:null===e.cursorIndex&&e.keyboardFocus&&!e.widgetFocus},on:{click:function(t){return t.target!==t.currentTarget?null:(t.stopPropagation(),e.handleFocusRuleInput(null))}}},[e._l(e.selectConditions,(function(t,a){return[i("div",{key:"a"+a,staticClass:"cursor",class:{focus:e.cursorIndex===a&&e.keyboardFocus&&!e.widgetFocus},on:{click:function(t){return t.stopPropagation(),e.handleFocusRuleInput(a)}}}),i("div",{key:"b"+a},["sensor"===t.type?i("div",{staticClass:"sensor"},[e._v("\n                  传感器\n                  "),i("el-select",{staticStyle:{"margin-left":"10px",width:"140px"},attrs:{size:"mini"},on:{change:function(i){return e.handleSelectSensor(i,t)},"visible-change":function(t){return e.handleFocusRuleInput(e.cursorIndex)}},model:{value:t.sensorId,callback:function(i){e.$set(t,"sensorId",i)},expression:"item.sensorId"}},e._l(e.sensorList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1),i("el-select",{staticStyle:{"margin-left":"10px",width:"140px"},attrs:{size:"mini"},on:{"visible-change":function(t){return e.handleFocusRuleInput(e.cursorIndex)}},model:{value:t.sensorAttrCode,callback:function(i){e.$set(t,"sensorAttrCode",i)},expression:"item.sensorAttrCode"}},e._l(e.sensorIdAttrMap[t.sensorId]||[],(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.code}})})),1)],1):"input"===t.type?i("el-input",{staticStyle:{width:"140px"},attrs:{size:"medium"},on:{focus:e.handleFocusWidgetInput,blur:e.handleBlurWidgetInput},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}}):"offline"===t.type?i("div",{staticClass:"sensor"},[e._v("\n                  传感器\n                  "),i("el-select",{staticStyle:{margin:"0 10px",width:"140px"},attrs:{size:"mini"},on:{change:function(i){return e.handleSelectSensor(i,t)},"visible-change":function(t){return e.handleFocusRuleInput(e.cursorIndex)}},model:{value:t.sensorId,callback:function(i){e.$set(t,"sensorId",i)},expression:"item.sensorId"}},e._l(e.sensorList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1),e._v("\n                  离线报警\n                  "),i("el-input",{staticStyle:{"margin-left":"10px",width:"140px"},attrs:{size:"mini",disabled:t.disabled},on:{focus:e.handleFocusWidgetInput,blur:e.handleBlurWidgetInput},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}}),i("el-select",{staticStyle:{"margin-left":"10px",width:"100px"},attrs:{size:"mini",placeholder:"请选择",disabled:t.disabled},model:{value:t.unit,callback:function(i){e.$set(t,"unit",i)},expression:"item.unit"}},e._l(e.offlineTimeUnit,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):i("el-button",{attrs:{size:"medium",disabled:""}},[e._v(e._s(t.value))])],1)]}))],2),i("div",{staticStyle:{"margin-top":"10px"}},[e._v(e._s(e.showExpression))]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.keyboardFocus,expression:"keyboardFocus"}],staticClass:"keyboard",staticStyle:{"margin-top":"10px"}},[i("table",{staticStyle:{width:"100%"}},[i("tr",[i("td",[i("el-button",{attrs:{size:"small",disabled:e.buttonDisabled},on:{click:function(t){return e.handleSelectKey({type:"sensor",value:"",sensorId:"",sensorAttrCode:""})}}},[e._v("传感器\n                  ")]),i("el-button",{attrs:{size:"small",disabled:e.buttonDisabled},on:{click:function(t){return e.handleSelectKey({type:"input",value:""})}}},[e._v("输入值")]),i("el-button",{attrs:{size:"small",disabled:e.buttonDisabled2},on:{click:function(t){return e.handleSelectKey({type:"offline",value:"",unit:"",disabled:!0})}}},[e._v("传感器离线\n                  ")])],1),i("td",e._l(e.symbolList,(function(t,a){return i("el-button",{key:a,staticStyle:{"font-weight":"bold"},attrs:{size:"small",disabled:!t.offline&&e.buttonDisabled},on:{click:function(i){return e.handleSelectKey(t)}}},[e._v(e._s(t.value)+"\n                  ")])})),1)])])])])]),i("el-form-item",{attrs:{label:"则",prop:"statusDefinitionId"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{size:"small"},model:{value:e.data.statusDefinitionId,callback:function(t){e.$set(e.data,"statusDefinitionId",t)},expression:"data.statusDefinitionId"}},e._l(e.accessStatusList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),i("el-form-item",{attrs:{label:"是否推送",prop:"pushMsg"}},[i("el-switch",{attrs:{"active-text":"是","inactive-text":"否"},model:{value:e.data.pushMsg,callback:function(t){e.$set(e.data,"pushMsg",t)},expression:"data.pushMsg"}})],1),e.data.pushMsg?i("el-form-item",{attrs:{label:"推送对象",prop:"object"}},[i("div",{staticStyle:{color:"#606266"}},[e._v("\n          角色：\n          "),i("el-select",{staticStyle:{width:"460px","margin-right":"20px"},attrs:{size:"small",multiple:""},model:{value:e.data.roleIds,callback:function(t){e.$set(e.data,"roleIds",t)},expression:"data.roleIds"}},e._l(e.roleList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1),e._v("\n          人员：\n          "),i("el-button",{staticStyle:{"margin-right":"8px"},attrs:{type:"primary"},on:{click:e.handleSelectPerson}},[e._v("选择")]),e._v("\n          已选 "+e._s(Object.keys(e.selectedPerson).length)+" 人\n        ")],1)]):e._e()],1),i("div",{staticClass:"footer"},[e.selectConditions.length?i("el-button",{attrs:{size:"small"},on:{click:e.checkExpression}},[e._v("校验规则")]):e._e(),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.handleDeleteCondition}},[e._v("删除")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSaveCondition}},[e._v("保存")])],1)],1),i("el-dialog",{attrs:{title:"选择人员",visible:e.personDialog,"close-on-click-modal":!1,width:"680px"},on:{"update:visible":function(t){e.personDialog=t}}},[i("div",{staticClass:"dialog-header"},[i("el-input",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{size:"small",placeholder:"请输入姓名"},model:{value:e.personName,callback:function(t){e.personName=t},expression:"personName"}}),i("q-search-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleCurrentChange(1)}}})],1),i("el-table",{ref:"table",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.personList},on:{select:e.handleSelectTable,"select-all":e.handleSelectAllTable}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),i("el-table-column",{attrs:{type:"index",label:"序号",width:"100",index:function(t){return(e.pageNum-1)*e.pageSize+t+1}}}),i("el-table-column",{attrs:{label:"姓名",prop:"realName"}}),i("el-table-column",{attrs:{label:"人员类型",prop:"typeName"}})],1),i("q-pagination",{attrs:{"current-page":e.pageNum,size:"small","page-size":e.pageSize,"page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t}}}),i("div",{staticClass:"dialog-footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.personDialog=!1}}},[e._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSurePerson}},[e._v("确定")])],1)],1)],1)},U=[];i("c5f6"),i("7514");function H(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function G(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?H(Object(i),!0).forEach((function(t){Object(f["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):H(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Q=B=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.keyboardFocus=!1,e.widgetFocus=!1,e.cursorIndex=null,e.symbolList=[{type:"symbol",code:"add",value:"+"},{type:"symbol",code:"subtract",value:"-"},{type:"symbol",code:"multiply",value:"×",realValue:"*"},{type:"symbol",code:"divide",value:"÷",realValue:"/"},{type:"symbol",code:"rt",value:">"},{type:"symbol",code:"rtEqual",value:"≥",realValue:">="},{type:"symbol",code:"lt",value:"<"},{type:"symbol",code:"ltEqual",value:"≤",realValue:"<="},{type:"lp",code:"lp",value:"("},{type:"rp",code:"rp",value:")"},{type:"symbol",code:"and",value:"and",offline:!0},{type:"symbol",code:"or",value:"or",offline:!0},{type:"symbol",code:"equal",value:"=="},{type:"symbol",code:"notEqual",value:"!="}],e.selectConditions=[],e.status="start",e.lpNum=0,e.rpNum=0,e.formRules={remark:{required:!0,message:"请输入说明"},statusDefinitionId:{required:!0,message:"请选择触发状态"}},e.personDialog=!1,e.personList=[],e.personName="",e.pageSize=5,e.pageNum=1,e.total=0,e.currentSelectPerson={},e.currentSelectLen=0,e.selectedPerson={},e.loading=!1,e.howLong="",e.timeUnit="",e.offlineTimeUnit=[{value:"小时",label:"小时"},{value:"分钟",label:"分钟"},{value:"秒",label:"秒"}],e.buttonDisabled=!1,e.buttonDisabled2=!1,e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.initData(),document.addEventListener("click",this.handleBlurRuleInput),document.addEventListener("keydown",this.handleKeydown)}},{key:"destroyed",value:function(){document.removeEventListener("click",this.handleBlurRuleInput),document.removeEventListener("keydown",this.handleKeydown),B.focusInstance&&B.focusInstance===this&&(B.focusInstance=null)}},{key:"initData",value:function(){var e=this,t=this.data.expressionJson;t=t?JSON.parse(t):[],this.selectConditions=t,t.forEach((function(t){"sensor"!==t.type||e.sensorIdAttrMap[t.sensorId]||(e.sensorIdAttrMap[t.sensorId]=[],e.$emit("getSensorAttr",t.sensorId))}));var i={},a=this.data.personIds||[];a.forEach((function(e){i[e]=!0})),this.selectedPerson=i;var n=t.length;n&&(this.status=t[n-1].type,this.lpNum=t.filter((function(e){return"lp"===e.type})).length,this.rpNum=t.filter((function(e){return"rp"===e.type})).length)}},{key:"handleFocusRuleInput",value:function(e){this.keyboardFocus=!0,this.cursorIndex=e,B.focusInstance&&B.focusInstance!==this&&B.focusInstance.handleBlurRuleInput(),B.focusInstance=this}},{key:"handleBlurRuleInput",value:function(){this.keyboardFocus=!1,B.focusInstance=null}},{key:"handleFocusWidgetInput",value:function(){this.widgetFocus=!0}},{key:"handleBlurWidgetInput",value:function(){this.widgetFocus=!1}},{key:"handleKeydown",value:function(e){if(this.reactKeydownEvent)switch(e.code.toLocaleLowerCase()){case"backspace":this.handleDeleteToken();break;case"arrowleft":this.handleMoveCursor(!1);break;case"arrowright":this.handleMoveCursor(!0);break}}},{key:"handleSelectKey",value:function(e){this.status=e.type;var t=G({},e);null===this.cursorIndex?this.selectConditions.push(t):(this.selectConditions.splice(this.cursorIndex,0,t),this.cursorIndex++),"offline"===e.type?(this.buttonDisabled=!0,this.buttonDisabled2=!1):"sensor"!==e.type&&"input"!==e.type||(this.buttonDisabled=!1,this.buttonDisabled2=!0)}},{key:"handleDeleteToken",value:function(){var e;if(null===this.cursorIndex?e=this.selectConditions.pop():this.cursorIndex>0&&(e=this.selectConditions.splice(this.cursorIndex-1,1)),e){switch(null!==this.cursorIndex&&this.cursorIndex--,e.code){case"lp":this.lpNum--;break;case"rp":this.rpNum--;break}var t=this.selectConditions[this.selectConditions.length-1];this.status=t?t.type:"start","start"===this.status&&(this.buttonDisabled=!1,this.buttonDisabled2=!1)}}},{key:"handleMoveCursor",value:function(e){e?null!==this.cursorIndex&&this.cursorIndex<this.selectConditions.length-1?this.cursorIndex++:this.cursorIndex===this.selectConditions.length-1&&(this.cursorIndex=null):null===this.cursorIndex?this.cursorIndex=this.selectConditions.length-1:this.cursorIndex>0&&this.cursorIndex--}},{key:"checkExpression",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.post(g["a"].checkExpression,{expression:this.realExpression});case 2:t=e.sent,i=t.data,a=i.status,n=i.message,a?this.$message.success("规则可用"):this.$message.error(n);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSelectSensor",value:function(e,t){this.$set(t,"sensorAttrCode",""),this.$set(t,"disabled",!1),this.sensorIdAttrMap[e]||this.$emit("getSensorAttr",e)}},{key:"handleSelectPerson",value:function(){this.personDialog=!0,this.currentSelectPerson=G({},this.selectedPerson),this.getPersonList()}},{key:"handleCurrentChange",value:function(e){this.pageNum=e,this.getPersonList()}},{key:"getPersonList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.post(g["a"].getPersonPaging,{query:{name:this.personName,deviceId:this.deviceId},current:this.pageNum,size:this.pageSize});case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?(this.personList=a.records,this.total=a.total,this.$nextTick((function(){r.personList.forEach((function(e){r.$refs.table.toggleRowSelection(e,!!r.currentSelectPerson[e.id])})),r.currentSelectLen=r.personList.filter((function(e){return!!r.currentSelectPerson[e.id]})).length}))):this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSelectTable",value:function(e,t){this.currentSelectLen<e.length?this.currentSelectPerson[t.id]=t:delete this.currentSelectPerson[t.id],this.currentSelectLen=e.length}},{key:"handleSelectAllTable",value:function(e){var t=this;e.length?e.forEach((function(e){t.currentSelectPerson[e.id]=e})):this.personList.forEach((function(e){delete t.currentSelectPerson[e.id]})),this.currentSelectLen=e.length}},{key:"handleSurePerson",value:function(){this.selectedPerson=JSON.parse(JSON.stringify(this.currentSelectPerson)),this.personDialog=!1}},{key:"handleDeleteCondition",value:function(){var e=this;this.data.id?this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.deleteCondition()})):this.$emit("delete")}},{key:"handleSaveCondition",value:function(){var e=this;this.$refs.form.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(i){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i&&(e.selectConditions.some((function(e){return"sensor"===e.type&&(!e.sensorId||!e.sensorAttrCode)}))?e.$message.info("请将所有传感器和属性选择完整"):e.doSaveCondition());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"doSaveCondition",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.$http.post(this.data.id?g["a"].updateStatusRule:g["a"].addStatusRule,{deviceId:this.deviceId,expression:this.realExpression,expressionShow:this.showExpression,expressionJson:JSON.stringify(this.selectConditions),id:this.data.id,personIds:Object.keys(this.selectedPerson),remark:this.data.remark,roleIds:this.data.roleIds,sensorIds:this.selectConditions.filter((function(e){return"sensor"===e.type})).map((function(e){return e.sensorId})),statusDefinitionId:this.data.statusDefinitionId,pushMsg:this.data.pushMsg});case 4:t=e.sent,i=t.data,a=i.status,n=i.message,a?(this.$message.success("保存成功"),this.$emit("update")):this.$message.error(n);case 9:return e.prev=9,this.loading=!1,e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[1,,9,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"deleteCondition",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].deleteByWarningTermId+this.data.id);case 2:t=e.sent,i=t.data,a=i.status,n=i.message,a?(this.$message.success("删除成功"),this.$emit("update")):this.$message.error(n);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showExpression",get:function(){var e=this;return this.selectConditions.map((function(t){if("sensor"===t.type){if(!t.sensorId)return"传感器（ ， ）";var i=e.sensorList.find((function(e){return e.id===t.sensorId}));if(!i)return"传感器已不属于此设备";var a=e.sensorIdAttrMap[t.sensorId];if(!a)return"传感器（ ".concat(i.name,"， ）");var n=a.find((function(e){return e.code===t.sensorAttrCode}));return"传感器（ ".concat(i.name,"，").concat(n?n.name:""," ）")}if("offline"===t.type){if(!t.sensorId)return"传感器（）离线报警（）";var s=e.sensorList.find((function(e){return e.id===t.sensorId}));return s?"传感器（ ".concat(s.name," ）离线报警（ ").concat(t.value," ").concat(t.unit," ）"):"传感器已不属于此设备"}return t.value})).join(" ")}},{key:"realExpression",get:function(){return this.selectConditions.map((function(e){if("sensor"===e.type)return"".concat(e.sensorId,"_").concat(e.sensorAttrCode);if("offline"===e.type){var t=1;switch(e.unit){case"小时":t=3600;break;case"分钟":t=60;break;case"秒":t=1;break}return e.sensorId&&"离线报警('".concat(e.sensorId,"', ").concat(e.value*t,")")}return e.realValue||e.value})).join(" ")}},{key:"accessStatusList",get:function(){var e=this;return this.allStatusList.filter((function(t){return!e.disableStatusIdMap[t.id]||t.id===e.data.statusDefinitionId}))}},{key:"reactKeydownEvent",get:function(){return this.keyboardFocus&&!this.widgetFocus}}]),t}(p["e"]);Q.focusInstance=null,u["__decorate"]([Object(p["d"])({type:Number,required:!0})],Q.prototype,"index",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],Q.prototype,"sensorList",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],Q.prototype,"allStatusList",void 0),u["__decorate"]([Object(p["d"])({type:Object,required:!0})],Q.prototype,"disableStatusIdMap",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],Q.prototype,"roleList",void 0),u["__decorate"]([Object(p["d"])({type:Object,required:!0})],Q.prototype,"sensorIdAttrMap",void 0),u["__decorate"]([Object(p["d"])({type:Object,required:!0})],Q.prototype,"data",void 0),u["__decorate"]([Object(p["d"])({type:String,required:!0})],Q.prototype,"deviceId",void 0),Q=B=u["__decorate"]([Object(p["a"])({})],Q);var X=Q,Y=X,Z=(i("85e5"),Object(S["a"])(Y,W,U,!1,null,"218883c9",null)),ee=Z.exports;function te(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function ie(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?te(Object(i),!0).forEach((function(t){Object(f["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):te(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var ae=1,ne=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.conditions=[],e.disableStatusIdMap={},e.roleList=[],e.sensorIdAttrMap={},e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getConditionList(),this.getRoleList()}},{key:"handleAddCondition",value:function(){this.conditions.unshift({key:ae++,pushMsg:!1})}},{key:"getConditionList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].listWarningTerms+this.deviceId);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?(a.forEach((function(e){e.statusDefinitionId=e.statusId})),this.conditions=a,r={},a.forEach((function(e){r[e.statusDefinitionId]=!0})),this.disableStatusIdMap=r):this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSensorAttr",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getSensorAttr+t);case 2:i=e.sent,a=i.data,n=a.data,s=a.status,r=a.message,s?(o=ie({},this.sensorIdAttrMap),o[t]=n,this.sensorIdAttrMap=o):this.$message.error(r);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getRoleList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getRoleList);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.roleList=a:this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String,required:!0})],ne.prototype,"deviceId",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],ne.prototype,"allStatusList",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],ne.prototype,"sensorList",void 0),ne=u["__decorate"]([Object(p["a"])({components:{StatusConditionConfig:ee}})],ne);var se,re=ne,oe=re,le=(i("8484"),Object(S["a"])(oe,J,K,!1,null,"1862114f",null)),ce=le.exports,de=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"header"},[i("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleAddCondition}},[e._v("添加事件条件")])],1),e._l(e.conditions,(function(t,a){return i("event-condition-config",{key:t.id||t.key,staticStyle:{"margin-top":"20px"},attrs:{index:a,data:t,"sensor-id-attr-map":e.sensorIdAttrMap,"sensor-list":e.sensorList,"all-event-list":e.allEventList,"disable-event-id-map":e.disableEventIdMap,"all-status-list":e.allStatusList,"device-id":e.deviceId},on:{getSensorAttr:e.getSensorAttr,update:e.getConditionList,delete:function(t){return e.conditions.splice(a,1)}}})}))],2)},ue=[],pe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"condition-container"},[i("div",{staticClass:"bar"},[i("div",{staticClass:"title"},[e._v("条件"+e._s(e.index+1))])]),i("el-form",{ref:"form",staticStyle:{"margin-top":"20px"},attrs:{model:e.form,rules:e.formRules,size:"small","label-width":"80px"}},[i("el-form-item",{attrs:{label:"说明",prop:"remark"}},[i("el-input",{attrs:{placeholder:"请输入说明"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),i("el-form-item",{attrs:{label:"当",prop:"expression"}},[i("div",{on:{click:function(t){return e.handleFocusRuleInput(e.cursorIndex)}}},[i("div",{staticClass:"condition-section",class:{focus:null===e.cursorIndex&&e.keyboardFocus&&!e.widgetFocus},on:{click:function(t){return t.target!==t.currentTarget?null:(t.stopPropagation(),e.handleFocusRuleInput(null))}}},[e._l(e.selectConditions,(function(t,a){return[i("div",{key:"a"+a,staticClass:"cursor",class:{focus:e.cursorIndex===a&&e.keyboardFocus&&!e.widgetFocus},on:{click:function(t){return t.stopPropagation(),e.handleFocusRuleInput(a)}}}),i("div",{key:"b"+a},["customFunc"===t.type?i("div",{staticClass:"sensor"},[e._l(t.widget,(function(t,a){return[t.isText?i("div",{key:a,staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.text))]):["select"===t.type?i("el-select",{key:a,staticClass:"input",attrs:{size:"mini"},on:{"visible-change":function(t){return e.handleFocusRuleInput(e.cursorIndex)}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}},e._l(e.allStatusList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1):e._e(),"input"===t.type?i("el-input",{key:a,staticClass:"input",attrs:{size:"mini"},on:{focus:e.handleFocusWidgetInput,blur:e.handleBlurWidgetInput},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}},[i("template",{slot:"append"},[e._v(e._s(t.text))])],2):e._e()]]}))],2):"status"===t.type?[e._v("\n                设备状态\n                "),i("el-select",{attrs:{size:"medium"},on:{"visible-change":function(t){return e.handleFocusRuleInput(e.cursorIndex)}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}},e._l(e.allStatusList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:t}})})),1)]:"input"===t.type?i("el-input",{staticStyle:{width:"140px"},attrs:{size:"medium"},on:{focus:e.handleFocusWidgetInput,blur:e.handleBlurWidgetInput},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}}):i("el-button",{attrs:{size:"medium"},on:{click:function(t){return e.handleEdit(a)}}},[e._v(e._s(t.value))])],2)]}))],2),i("div",{staticStyle:{"margin-top":"10px"}},[e._v(e._s(e.showExpression))]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.keyboardFocus,expression:"keyboardFocus"}],staticClass:"keyboard",staticStyle:{"margin-top":"10px"}},[i("table",{staticStyle:{width:"100%","table-layout":"fixed"}},[i("tr",[i("td",e._l(e.customFuncTypes,(function(t,a){return i("el-button",{key:a,staticClass:"key",attrs:{size:"small"},on:{click:function(i){return e.handleSelectKey(t)}}},[e._v(e._s(t.name))])})),1),i("td",e._l(e.symbolList,(function(t,a){return i("el-button",{key:a,staticClass:"key",staticStyle:{"font-weight":"bold"},attrs:{size:"small"},on:{click:function(i){return e.handleSelectKey(t)}}},[e._v(e._s(t.value)+"\n                ")])})),1)])])])])]),i("el-form-item",{attrs:{label:"则",prop:"eventDefinitionId"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{size:"small",filterable:""},model:{value:e.form.eventDefinitionId,callback:function(t){e.$set(e.form,"eventDefinitionId",t)},expression:"form.eventDefinitionId"}},e._l(e.accessEventList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1)],1),i("div",{staticClass:"footer"},[e.selectConditions.length?i("el-button",{attrs:{size:"small"},on:{click:e.checkExpression}},[e._v("校验规则")]):e._e(),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.handleDeleteCondition}},[e._v("删除")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSaveCondition}},[e._v("保存")])],1)],1)},me=[],ve=se=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.keyboardFocus=!1,e.widgetFocus=!1,e.cursorIndex=null,e.symbolList=[{type:"lp",code:"lp",value:"("},{type:"rp",code:"rp",value:")"},{type:"symbol",code:"and",value:"and"},{type:"symbol",code:"or",value:"or"}],e.form={},e.formRules={remark:{required:!0,message:"请输入说明"},eventDefinitionId:{required:!0,message:"请选择触发事件"}},e.selectConditions=[],e.status="start",e.lpNum=0,e.rpNum=0,e.customFuncTypes=[{name:"持续（状态，持续，分钟）",type:"customFunc",funcName:"持续",widget:[{type:"select",text:"状态"},{text:"持续",isText:!0},{type:"input",text:"分钟",scale:60}]},{name:"连续（状态，次数，连续，分钟）",type:"customFunc",funcName:"连续",widget:[{type:"select",text:"状态"},{type:"input",text:"分钟",scale:60},{text:"连续",isText:!0},{type:"input",text:"次"}]},{name:"发生（状态，次数，发生，分钟）",type:"customFunc",funcName:"发生",widget:[{type:"select",text:"状态"},{type:"input",text:"分钟",scale:60},{text:"发生",isText:!0},{type:"input",text:"次"}]}],e.loading=!1,e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.initData(),document.addEventListener("click",this.handleBlurRuleInput,!0),document.addEventListener("keydown",this.handleKeydown)}},{key:"destroyed",value:function(){document.removeEventListener("click",this.handleBlurRuleInput),document.removeEventListener("keydown",this.handleKeydown),se.focusInstance&&se.focusInstance===this&&(se.focusInstance=null)}},{key:"initData",value:function(){this.form=JSON.parse(JSON.stringify(this.data));var e=this.form.expressionJson;e=e?JSON.parse(e):[],this.selectConditions=e;var t=e.length;t&&(this.status=e[t-1].type,this.lpNum=e.filter((function(e){return"lp"===e.type})).length,this.rpNum=e.filter((function(e){return"rp"===e.type})).length)}},{key:"handleFocusRuleInput",value:function(e){this.keyboardFocus=!0,this.cursorIndex=e,se.focusInstance&&se.focusInstance!==this&&se.focusInstance.handleBlurRuleInput(),se.focusInstance=this}},{key:"handleBlurRuleInput",value:function(){this.keyboardFocus=!1,se.focusInstance=null}},{key:"handleFocusWidgetInput",value:function(){this.widgetFocus=!0}},{key:"handleBlurWidgetInput",value:function(){this.widgetFocus=!1}},{key:"handleKeydown",value:function(e){if(this.reactKeydownEvent)switch(e.code.toLocaleLowerCase()){case"backspace":this.handleDeleteToken();break;case"arrowleft":this.handleMoveCursor(!1);break;case"arrowright":this.handleMoveCursor(!0);break}}},{key:"handleSelectKey",value:function(e){this.status=e.type;var t=JSON.parse(JSON.stringify(e));null===this.cursorIndex?this.selectConditions.push(t):(this.selectConditions.splice(this.cursorIndex,0,t),this.cursorIndex++)}},{key:"handleDeleteToken",value:function(){var e;if(null===this.cursorIndex?e=this.selectConditions.pop():this.cursorIndex>0&&(e=this.selectConditions.splice(this.cursorIndex-1,1)),e){switch(null!==this.cursorIndex&&this.cursorIndex--,e.code){case"lp":this.lpNum--;break;case"rp":this.rpNum--;break}var t=this.selectConditions[this.selectConditions.length-1];this.status=t?t.type:"start"}}},{key:"handleMoveCursor",value:function(e){e?null!==this.cursorIndex&&this.cursorIndex<this.selectConditions.length-1?this.cursorIndex++:this.cursorIndex===this.selectConditions.length-1&&(this.cursorIndex=null):null===this.cursorIndex?this.cursorIndex=this.selectConditions.length-1:this.cursorIndex>0&&this.cursorIndex--}},{key:"checkWidget",value:function(){return!this.selectConditions.some((function(e){return"customFunc"===e.type&&e.widget.filter((function(e){return!e.isText})).some((function(e){return!e.value}))}))||(this.$message.info("请将所有状态的持续时间和次数补充完整"),!1)}},{key:"checkExpression",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.checkWidget()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$http.post(g["a"].checkExpression,{expression:this.realExpression});case 4:t=e.sent,i=t.data,a=i.status,n=i.message,a?this.$message.success("规则可用"):this.$message.error(n);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSaveCondition",value:function(){var e=this;this.$refs.form.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(i){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!i){t.next=4;break}if(e.checkWidget()){t.next=3;break}return t.abrupt("return");case 3:e.doSaveCondition();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"doSaveCondition",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.$http.post(this.form.id?g["a"].updateEventRule:g["a"].addEventRule,{deviceId:this.deviceId,eventDefinitionId:this.form.eventDefinitionId,expression:this.realExpression,expressionShow:this.showExpression,expressionJson:JSON.stringify(this.selectConditions),id:this.form.id,remark:this.form.remark});case 4:t=e.sent,i=t.data,a=i.status,n=i.message,a?(this.$message.success("保存成功"),this.$emit("update")):this.$message.error(n);case 9:return e.prev=9,this.loading=!1,e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[1,,9,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleDeleteCondition",value:function(){var e=this;this.form.id?this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.deleteCondition()})):this.$emit("delete")}},{key:"deleteCondition",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].deleteByEventTermId+this.form.id);case 2:t=e.sent,i=t.data,a=i.status,n=i.message,a?(this.$message.success("删除成功"),this.$emit("update")):this.$message.error(n);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showExpression",get:function(){var e={};return this.allStatusList.forEach((function(t){e[t.id]=t})),this.selectConditions.map((function(t){return"customFunc"===t.type?"（".concat(t.widget.map((function(t){if(t.isText)return t.text;if("select"===t.type){var i=e[t.value];return i?i.name:""}return t.value?t.value+t.text:""})).join("，"),"）"):t.value})).join(" ")}},{key:"realExpression",get:function(){var e=this;return this.selectConditions.map((function(t){return"customFunc"===t.type?"".concat(t.funcName,"(").concat(t.widget.filter((function(e){return!e.isText})).map((function(t){return"select"===t.type?"'"+e.deviceId+"_"+t.value+"'":t.scale?t.value*t.scale:t.value})).join(","),")"):t.realValue||t.value})).join(" ")}},{key:"accessEventList",get:function(){var e=this;return this.allEventList.filter((function(t){return!e.disableEventIdMap[t.id]||t.id===e.data.eventDefinitionId}))}},{key:"reactKeydownEvent",get:function(){return this.keyboardFocus&&!this.widgetFocus}}]),t}(p["e"]);ve.focusInstance=null,u["__decorate"]([Object(p["d"])({type:Number,required:!0})],ve.prototype,"index",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],ve.prototype,"sensorList",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],ve.prototype,"allEventList",void 0),u["__decorate"]([Object(p["d"])({type:Object,required:!0})],ve.prototype,"disableEventIdMap",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],ve.prototype,"allStatusList",void 0),u["__decorate"]([Object(p["d"])({type:Object,required:!0})],ve.prototype,"data",void 0),u["__decorate"]([Object(p["d"])({type:String,required:!0})],ve.prototype,"deviceId",void 0),ve=se=u["__decorate"]([Object(p["a"])({})],ve);var he=ve,fe=he,ge=(i("08fb"),Object(S["a"])(fe,pe,me,!1,null,"5076e49c",null)),ye=ge.exports;function be(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function ke(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?be(Object(i),!0).forEach((function(t){Object(f["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var xe=1,we=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.conditions=[],e.sensorList=[],e.allEventList=[],e.disableEventIdMap={},e.roleList=[],e.sensorIdAttrMap={},e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getSensorList(),this.getConditionList(),this.getEventList(),this.getRoleList()}},{key:"handleAddCondition",value:function(){this.conditions.unshift({key:xe++})}},{key:"getConditionList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].listEventTerms+this.deviceId);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?(this.conditions=a,r={},a.forEach((function(e){r[e.eventDefinitionId]=!0})),this.disableEventIdMap=r):this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSensorList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getBindSensor+this.deviceId);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.sensorList=a:this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSensorAttr",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getSensorAttr+t);case 2:i=e.sent,a=i.data,n=a.data,s=a.status,r=a.message,s?(o=ke({},this.sensorIdAttrMap),o[t]=n,this.sensorIdAttrMap=o):this.$message.error(r);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getEventList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.post(g["a"].getEventDefinition,{current:0,size:9999});case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.allEventList=a.records:this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getRoleList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getRoleList);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.roleList=a:this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String,required:!0})],we.prototype,"deviceId",void 0),u["__decorate"]([Object(p["d"])({type:Array,required:!0})],we.prototype,"allStatusList",void 0),we=u["__decorate"]([Object(p["a"])({components:{EventConditionConfig:ye}})],we);var Se=we,De=Se,Ie=(i("916a"),Object(S["a"])(De,de,ue,!1,null,"56d4f497",null)),Oe=Ie.exports,Ce=i("75fb"),_e=window.AMap,Le=window.AMapUI,$e=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.loading=!1,e.activeName="1",e.customOptions=[],e.deviceDetailsForm={},e.orgOptions=[],e.orgVisible=!1,e.deviceDetailsFormRules={name:[{required:!0,message:"该选项为必填项",trigger:"change"}],typeDetailId:[{required:!0,message:"该选项为必填项",trigger:"change"}],orgId:[{required:!0,message:"该选项为必填项",trigger:"change"}]},e.deviceTypeOptions=[],e.typeVisible=!1,e.hasCustomRole=qTouch.getBaseTypeByCode("device"),e.statusOptions=[{value:!0,label:"是"},{value:!1,label:"否"}],e.disabled=!1,e.visible=!0,e.pagination={condition:"",tableData:[],currentPage:1,pageSize:10,total:0},e.classifyOptions=[],e.typeDetailProps={label:"name",value:"id",checkStrictly:!0},e.classVisible=!1,e.marker=null,e.addressDialog=!1,e.text="建筑物坐标绑定",e.showLeaveChoose=!1,e.zoom=18,e.center=[106.569137124949,29.643814122592],e.allStatusList=[],e.sensorList=[],e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"switchToDeviceList",value:function(){}},{key:"changeListRowId",value:function(e){this.$emit("update:deviceId",e)}},{key:"deviceIdChange",value:function(){this.deviceId&&this.getDeviceInfo(this.deviceId),this.getClassifyTree(),this.getOrganizations(),this.getDeviceTypes()}},{key:"getDeviceTypeStatusList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(g["a"].getDeviceTypeStatusList+this.deviceDetailsForm.typeDetailId);case 2:t=e.sent,i=t.data,a=i.data,n=i.status,s=i.message,n?this.allStatusList=a.filter((function(e){return!e.defaultStatus})):this.$message.error(s);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getClassifyTree",value:function(){var e=this;this.classVisible=!0,this.$http.get(g["a"].classifyTree).then((function(t){t.data.status?e.classifyOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"getOrganizations",value:function(){var e=this;this.orgVisible=!0,this.$http.get(g["a"].getNewOrgTree).then((function(t){t.data.status?e.orgOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"saveOrg",value:function(){}},{key:"saveClass",value:function(){}},{key:"getDeviceInfo",value:function(e){var t=this;this.loading=!0,this.$http.get(g["a"].getOneById+"/"+e).then((function(e){t.loading=!1,e.data.status?(t.deviceDetailsForm=e.data.data,t.deviceDetailsForm.extInfoVO&&(t.customOptions=t.deviceDetailsForm.extInfoVO),t.getDeviceTypeStatusList()):t.$message.error(e.data.message)}))}},{key:"handleEditClass",value:function(){this.getClassifyTree()}},{key:"getDeviceTypes",value:function(){var e=this;this.$http.get(g["a"].findTypeTree+"/device").then((function(t){t.data.status?e.deviceTypeOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"handleTypeChange",value:function(e,t,i){t&&this.$refs.typeTree.setCheckedKeys([e.id])}},{key:"saveType",value:function(){this.$refs.deviceDetailsForm.validateField("typeDetailId",(function(){})),this.deviceDetailsForm.typeDetailId&&this.getCustomOptions()}},{key:"getCustomOptions",value:function(){var e=this;this.$http.get(g["a"].getTemplateByTypeDetaiId+"/"+this.deviceDetailsForm.typeDetailId).then((function(t){t.data.status?e.customOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"getFilledCustomOptions",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs["custom-input"],t){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,t.formValidation();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"saveDevice",value:function(){var e=this;this.$refs.deviceDetailsForm.validate((function(t){t&&(e.loading=!0,e.deviceDetailsForm.needUpload?(delete e.deviceDetailsForm.needUpload,e.$refs.upload.submit()):e.doSubmit())}))}},{key:"doSubmit",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getFilledCustomOptions();case 3:if(t=e.sent,!t){e.next=8;break}return e.next=7,this.getFilledCustomOptions();case 7:this.deviceDetailsForm.extInfo=e.sent;case 8:delete this.deviceDetailsForm.extInfoVO,i=g["a"].add,this.deviceId&&(i=g["a"].update),this.$http.post(i,this.deviceDetailsForm).then((function(e){e.data.status?(a.$message.success(e.data.message+"，可进行传感器绑定"),e.data.data&&a.changeListRowId(e.data.data),a.switchToDeviceList()):a.$message.error(e.data.message)})).finally((function(){a.loading=!1}));case 12:return e.prev=12,this.loading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,,12,15]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"customHttpRequest",value:function(e){var t=this,i=m["a"].createUploadForm(e.file);this.$http.post(e.action,i.formData,i.config).then((function(e){e.data.status?(t.deviceDetailsForm.image=e.data.data.accessUrl,t.doSubmit()):t.$message.error("图片上传失败")})).finally((function(){t.loading=!1}))}},{key:"customChange",value:function(e,t){var i=Object(Ce["b"])(e.raw),a=i.status,n=i.message;a?(this.$set(this.deviceDetailsForm,"image",e.url),this.deviceDetailsForm.needUpload=!0):(this.$message.error(n),this.$refs.upload.handleRemove(e))}},{key:"handleRemove",value:function(){var e=this;this.deviceDetailsForm.image="",this.$nextTick((function(){e.$refs.upload.clearFiles()}))}},{key:"bindAddress",value:function(){var e=this;this.addressDialog=!0,this.$nextTick((function(){if(e.deviceDetailsForm.location){var t=JSON.parse(e.deviceDetailsForm.location);e.initMap(t),e.addBuildMarker(t,e.deviceDetailsForm.address),e.showLeaveChoose=!1,e.text="当前建筑绑定坐标为："+e.deviceDetailsForm.location}else e.text="请在地图上选取建筑物位置，并双击确定！",e.initMap(e.center),e.chooseSiteOnMap()}))}},{key:"initMap",value:function(e){var t=this;this.map=new _e.Map("deviceAmap",{center:e,zoom:this.zoom,features:["bg","point","road","building"]}),Le.loadUI(["misc/PoiPicker"],(function(e){var i=new e({input:"deviceInput"});t.poiPickerReady(i)}))}},{key:"poiPickerReady",value:function(e){var t=this;window.poiPicker=e;var i=new _e.Marker;e.on("poiPicked",(function(e){var a=e.source,n=e.item;n.id,n.name,n.location.toString(),n.formattedAddress;i.setMap(t.map),i.setPosition(n.location),t.map.setCenter(i.getPosition())}))}},{key:"addBuildMarker",value:function(e,t){this.marker=new _e.Marker({position:e}),this.marker.setLabel({offset:new _e.Pixel(20,-20),content:"<div style='margin: 2px 5px;font-family: PingFang SC;line-height: 16px'>"+t+"</div>"}),this.marker.setMap(this.map)}},{key:"chooseOff",value:function(){this.text="建筑物坐标绑定",this.showLeaveChoose=!1,this.initMap(this.center)}},{key:"chooseSiteOnMap",value:function(){var e=this;this.showLeaveChoose=!0,this.text="请在地图上选取建筑物位置，并双击确定！",this.map.clearMap(),this.map.setDefaultCursor("crosshair"),this.map.on("dblclick",(function(t){var i=[t.lnglat.getLng(),t.lnglat.getLat()];e.text="您选取了 "+JSON.stringify(i)+" 的位置！";var a=new _e.Geocoder({radius:1e3,extensions:"all"});a.getAddress(i,(function(t,a){if("complete"===t&&"OK"===a.info){var n=a.regeocode.formattedAddress;e.$prompt("当前选中位置：","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:n}).then((function(t){e.deviceDetailsForm.location=JSON.stringify(i),e.deviceDetailsForm.address=t.value,e.addressDialog=!1})).catch((function(){e.text="请在地图上选取建筑物位置，并双击确定！"}))}}))}))}},{key:"destroyMap",value:function(){this.map.destroy()}}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String})],$e.prototype,"deviceId",void 0),u["__decorate"]([Object(p["b"])("switch")],$e.prototype,"switchToDeviceList",null),u["__decorate"]([Object(p["f"])("deviceId",{immediate:!0})],$e.prototype,"deviceIdChange",null),$e=u["__decorate"]([Object(p["a"])({components:{DeviceCondition:I,DeviceSensor:V,DeviceStyle:R,StatusAlarmCondition:ce,EventAlarmCondition:Oe}})],$e);var je=$e,Te=je,Fe=(i("f061"),Object(S["a"])(Te,a,n,!1,null,"13809b20",null));t["a"]=Fe.exports},bd11:function(e,t,i){},c277:function(e,t,i){"use strict";var a=i("1060"),n=i.n(a);n.a},cd1c:function(e,t,i){var a=i("e853");e.exports=function(e,t){return new(a(e))(t)}},e76b:function(e,t,i){},e853:function(e,t,i){var a=i("d3f4"),n=i("1169"),s=i("2b4c")("species");e.exports=function(e){var t;return n(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!n(t.prototype)||(t=void 0),a(t)&&(t=t[s],null===t&&(t=void 0))),void 0===t?Array:t}},e8a8:function(e,t,i){},ef0f:function(e,t,i){"use strict";var a="/admin/device/",n={getPaging:"/admin/device/pagingDevice",add:"/admin/device/add",update:"/admin/device/update",delete:"/admin/device/delete",multipleDelete:"/admin/device/multipleDelete",getNewOrgTree:"/admin/organization/orgTree/device",getOneById:"/admin/device/getOneById",addCondition:"/admin/device/condition/add",updateCondition:"/admin/device/condition/update",deleteCondition:"/admin/device/condition/delete/",getConditionList:"/admin/device/condition/listByDeviceId/",updateConditionItem:"/admin/device/condition/item/update/deviceConditionId/",getDeviceStatusList:"/admin/device/status/listByDeviceId/",updateDeviceStatusStyle:"/admin/device/status/updateStyle/deviceStatusId/",addDeviceStatusConditions:"/admin/device/status/condition/addDeviceStatusConditions/",getDeviceTypeTree:"/admin/typeDetail/findTypeTree/device",classifyTree:a+"classify/list",addClassify:a+"classify/add",updateClassify:a+"classify/update",deleteClassify:a+"classify/delete/",getClaasifyDeviceList:a+"classify/relation/bindingInfo/classifyId/",listNotBindByClassifyId:a+"classify/relation/listNotBindByClassifyId/classifyId/",classifyBind:a+"classify/relation/bind",classifyUnbind:a+"classify/relation/unbind/relationId/",multipleDeleteDevice:"/admin/device/multipleDelete",deleteOneDevice:"/admin/device/",getOneDevice:a+"getOneById/",addDeviceInfo:a+"add",updateDeviceInfo:a+"update",deviceBindSensor:a+"sensor/bind/deviceId/",getBindSensor:a+"sensor/listSensorByDeviceId/deviceId/",deleteBindSensor:a+"sensor/unbind",getSensorPage:"/admin/sensor/paging",getSensorAttr:"/admin/sensor/attribute/listBySensorId/",getEventDefinition:"/admin/event/definition/paging",findTypeTree:"/admin/typeDetail/findTypeTree",getTemplateByTypeDetaiId:"/admin/typeDetail/getTemplateByTypeDetaiId",getTypeDetail:"/admin/typeDetail",deleteType:"/admin/typeDetail/delete",saveCustomAttrItems:"/admin/typeDetail/saveCustomAttrItems",sensorHistory:"/admin/sensor/deviceSensorDataToChart/",getCurrentData:"/admin/sensor/deviceCurrentSensorDataToChart/",getTimeQuantumData:"/admin/sensor/staticDeviceSensorDataToChart",getDeviceTypeStatusList:"/admin/deviceStatusDefinition/listByDeviceTypeId/",addDeviceStatus:"/admin/deviceStatusDefinition/add",updateDeviceStatus:"/admin/deviceStatusDefinition/update",deleteDeviceStatus:"/admin/deviceStatusDefinition/delete/",getStatusInfoByStatusId:"/admin/deviceStatusDefinition/getInfoByStatusId/",getDeviceAlarmRecord:"/admin/device/terms/getWarningRecords",listWarningTerms:"/admin/device/terms/listWarningTerms/",addStatusRule:"/admin/device/terms/addStatusRule",updateStatusRule:"/admin/device/terms/updateStatusRule",deleteByWarningTermId:"/admin/device/terms/deleteByWarningTermId/",getAccessStatus:"/admin/device/terms/getAccessStatus/",getPersonPaging:"/admin/person/pagingMessagePerson",getRoleList:"/admin/role/list",listEventTerms:"/admin/device/terms/listEventTerms/",addEventRule:"/admin/device/terms/addEventRule",updateEventRule:"/admin/device/terms/updateEventsRule",deleteByEventTermId:"/admin/device/terms/deleteByEventTermId/",checkExpression:"/admin/device/terms/checkRule",download:"/api/excel/download/deviceTemplate",upload:"/api/excel/upload/deviceTemplate"};t["a"]=n},f061:function(e,t,i){"use strict";var a=i("e76b"),n=i.n(a);n.a},fe29:function(e,t,i){"use strict";var a=i("9107"),n=i.n(a);n.a}}]);
//# sourceMappingURL=chunk-cc9c97c2.97b78d6d.js.map